angular.module("personalizationsmarteditCommons",["alertServiceModule","commonsTemplates"]).factory("personalizationsmarteditUtils",function(){var a={};return a.pushToArrayIfValueExists=function(a,b,c){c&&a.push({key:b,value:c})},a.getContainerIdForElement=function(a){var b=a.closest('[data-smartedit-container-id][data-smartedit-container-type="CxCmsComponentContainer"]');return b.length?b.data().smarteditContainerId:null},a.getContainerIdForComponent=function(b,c){var d=angular.element('[data-smartedit-component-id="'+c+'"][data-smartedit-component-type="'+b+'"]');return angular.isArray(d)&&(d=d[0]),a.getContainerIdForElement(d)},a.getSlotIdForElement=function(a){var b=a.closest('[data-smartedit-component-type="ContentSlot"]');return b.length?b.data().smarteditComponentId:null},a.getSlotIdForComponent=function(b,c){var d=angular.element('[data-smartedit-component-id="'+c+'"][data-smartedit-component-type="'+b+'"]');return angular.isArray(d)&&(d=d[0]),a.getSlotIdForElement(d)},a.getVariationCodes=function(a){if("undefined"==typeof a||null===a)return[];var b=a.map(function(a){return a.code}).filter(function(a){return"undefined"!=typeof a});return b},a.getPageId=function(){return/page\-([\w]+)/.exec($("iframe").contents().find("body").attr("class"))[1]},a.getVariationKey=function(a,b){if(void 0===a||void 0===b)return[];var c=b.map(function(a){return a.code}).filter(function(a){return"undefined"!=typeof a}).map(function(b){return{variationCode:b,customizationCode:a}});return c},a.getSegmentTriggerForVariation=function(a){var b=a.triggers||[],c=b.filter(function(a){return"segmentTriggerData"===a.type});return 0===c.length?{}:c[0]},a.getActionIdForElement=function(a){var b=a.closest("[data-smartedit-personalization-action-id]");return b.length?b.data().smarteditPersonalizationActionId:null},a}).factory("personalizationsmarteditMessageHandler",["alertService",function(a){var b=function(b,c){a.pushAlerts([{successful:c,message:b}])},c={};return c.sendInformation=function(a){b(a,!0)},c.sendError=function(a){b(a,!1)},c}]),angular.module("personalizationsmarteditCommons").directive("personalizationInfiniteScroll",["$rootScope","$window","$timeout",function(a,b,c){return{link:function(d,e,f){var g,h,i,j;return b=angular.element(b),e.css("overflow-y","auto"),e.css("overflow-x","hidden"),e.css("height","inherit"),i=0,null!==f.personalizationInfiniteScrollDistance&&d.$watch(f.personalizationInfiniteScrollDistance,function(a){return i=parseInt(a,10)}),j=!0,g=!1,null!==f.personalizationInfiniteScrollDisabled&&d.$watch(f.personalizationInfiniteScrollDisabled,function(a){return j=!a,j&&g?(g=!1,h()):void 0}),a.$on("refreshStart",function(){e.animate({scrollTop:"0"})}),h=function(){var b,c,h,k,l;return b=$(e.children()[0]),c=e.offset().top+e.height(),l=b.offset().top+b.height(),h=l-c,k=h<=e.height()*i,k&&j?a.$$phase?d.$eval(f.personalizationInfiniteScroll):d.$apply(f.personalizationInfiniteScroll):k?g=!0:void 0},e.on("scroll",h),d.$on("$destroy",function(){return b.off("scroll",h)}),c(function(){return f.personalizationInfiniteScrollImmediateCheck?d.$eval(f.personalizationInfiniteScrollImmediateCheck)?h():void 0:h()},0)}}}]),angular.module("personalizationsmarteditCommons").directive("personalizationsmarteditPagination",function(){return{template:'<div ng-include="getContentUrl()"></div>',restrict:"E",scope:{callback:"=",pages:"=",currentPage:"=",pageSizes:"=",currentSize:"=",pagesOffset:"=",fixedPageSize:"="},link:function(a,b,c){a.callback||console.log("callback is undefined!"),a.pages=a.pages||[0,1,2],a.currentPage=a.currentPage||0,a.pageSizes=a.pageSizes||[5,10,25,50,100],a.currentSize=a.currentSize||10,a.pagesOffset=a.pagesOffset||2,a.fixedPageSize=a.fixedPageSize||!1,a.getContentUrl=function(){return c.template=c.template||"personalizationsmarteditPaginationTemplate.html","web/features/commons/personalizationsmarteditPagination/"+c.template},a.pageClick=function(b){a.currentPage!==b&&(a.currentPage=b,a.callback(a))},a.pageSizeClick=function(b){a.currentSize!==b&&(a.currentSize=b,a.currentPage=0,a.callback(a))},a.hasPrevious=function(){return a.currentPage>0},a.hasNext=function(){return a.currentPage<a.pages.length-1},a.isActive=function(b){return a.currentPage===b},a.nextClick=function(){a.hasNext()&&(a.currentPage++,a.callback(a))},a.prevClick=function(){a.hasPrevious()&&(a.currentPage--,a.callback(a))},a.pagesToDisplay=function(){var b=2*a.pagesOffset+1;if(a.pages.length<=b)return a.pages;var c=Math.max(a.currentPage-a.pagesOffset,0);return c+b>a.pages.length&&(c=a.pages.length-b),a.pages.slice(c,c+b)},a.availablePageSizes=function(){return a.pageSizes},a.getCurrentPageSize=function(){return a.currentSize},a.isFixedPageSize=function(){return a.fixedPageSize}}}}),angular.module("commonsTemplates",[]).run(["$templateCache",function(a){"use strict";a.put("web/features/commons/personalizationsmarteditPagination/personalizationsmarteditPaginationLefttoolbarTemplate.html",'<div class="row">\n\n    <div class="col-xs-12">\n        <ul class="pagination">\n            <li ng-click="prevClick()" ng-class="hasPrevious()?\'enabled\':\'disabled\'"><a>&laquo;</a></li>\n            <li ng-repeat="i in pagesToDisplay()"><a ng-click="pageClick(i)" ng-class="isActive({{i}})?\'active\':\'\'">{{i+1}}</a></li>\n            <li ng-click="nextClick()" ng-class="hasNext()?\'enabled\':\'disabled\'"><a>&raquo;</a></li>\n        </ul>\n    </div>\n</div>'),a.put("web/features/commons/personalizationsmarteditPagination/personalizationsmarteditPaginationTemplate.html",'<div class="row">\n    <div class="col-xs-4"></div>\n    <div class="col-xs-4">\n        <ul class="pagination pagination-lg">\n            <li ng-click="prevClick()" ng-class="hasPrevious()?\'enabled\':\'disabled\'"><a>&laquo;</a></li>\n            <li ng-repeat="i in pagesToDisplay()"><a ng-click="pageClick(i)" ng-class="isActive({{i}})?\'active\':\'\'">{{i+1}}</a></li>\n            <li ng-click="nextClick()" ng-class="hasNext()?\'enabled\':\'disabled\'"><a>&raquo;</a></li>\n        </ul>\n    </div>\n    <div class="col-xs-2"></div>\n    <div class="col-xs-2" ng-if="!isFixedPageSize()">\n        <button type="button" class="btn btn-link dropdown-toggle pull-right" data-toggle="dropdown">\n            <span ng-bind="getCurrentPageSize()"></span>\n            <span data-translate="personalization.pagination.rowsperpage"></span>\n            <span class="hyicon hyicon-arrow"></span>\n        </button>\n        <ul class="dropdown-menu pull-right text-left" role="menu">\n            <li ng-repeat="i in availablePageSizes() track by $index"><a ng-click="pageSizeClick(i)">{{i}}</a></li>\n        </ul>\n    </div>\n</div>')}]),angular.module("personalizationsmarteditComponentLightUpDecorator",["personalizationsmarteditTemplates","personalizationsmarteditContextServiceModule","personalizationsmarteditCommons"]).directive("personalizationsmarteditComponentLightUp",["personalizationsmarteditContextService","personalizationsmarteditUtils",function(a,b){return{templateUrl:"web/features/personalizationsmartedit/componentLightUpDecorator/personalizationsmarteditComponentLightUpDecoratorTemplate.html",restrict:"C",transclude:!0,replace:!1,scope:{smarteditComponentId:"@",smarteditComponentType:"@"},link:function(c,d,e){var f=function(){var c=a.isPersonalizationContextEnabled(),e=b.getContainerIdForElement(d),f=$.inArray(e,a.selectedComponents)>-1;return c&&f},g=function(){var b=f();return b=b&&angular.isArray(a.selectedVariations)},h=function(){var b=f();return b=b&&angular.isObject(a.selectedVariations),b=b&&!angular.isArray(a.selectedVariations)};c.getPersonalizationComponentBorderClass=function(){var a=d.parent().closest('[data-smartedit-container-id][data-smartedit-container-type="CxCmsComponentContainer"]');a.removeClass("personalizationsmarteditVariationComponentSelected"),a.removeClass("personalizationsmarteditVariationComponentSelected-icon"),a.removeClass("personalizationsmarteditComponentSelected"),h()&&(a.addClass("personalizationsmarteditVariationComponentSelected"),a.addClass("personalizationsmarteditVariationComponentSelected-icon")),g()&&a.addClass("personalizationsmarteditComponentSelected")}}}}]),angular.module("personalizationsmarteditContextMenu",["gatewayProxyModule"]).factory("personalizationsmarteditContextModal",["gatewayProxy",function(a){var b=function(){this.gatewayId="personalizationsmarteditContextModal",a.initForService(this)};return b.prototype.openDeleteAction=function(a,b,c,d,e){},b.prototype.openAddAction=function(a,b,c,d,e){},b.prototype.openEditAction=function(a,b,c,d,e){},b.prototype.openInfoAction=function(){},new b}]),jQuery(document).ready(function(a){var b=function(b){var c=a("<link rel='stylesheet' type='text/css' href='"+b+"'>");a("head").append(c)};b("/personalizationsmartedit/css/style.css")}),angular.module("personalizationsmarteditmodule",["decoratorServiceModule","personalizationsmarteditContextServiceModule","personalizationsmarteditComponentLightUpDecorator","personalizationsmarteditContextMenu","personalizationsmarteditCommons","featureServiceModule"]).directive("body",["personalizationsmarteditContextService",function(a){return{link:function(b,c,d){b.$watch(function(){return c.attr("data-smartedit-ready")},function(b,c){b===c||b!==!0&&"true"!==b||a.applySynchronization()},!0),b.$watch("element.class",function(){var b=c.attr("class").split(" ").filter(function(a){return/smartedit-page-uid\-(\S+)/.test(a)});if(b.length>0){var d=/smartedit-page-uid\-(\S+)/.exec(b[0])[1];a.setPageId(d),b.length>1&&console.log("more than one page- class element attribute defined")}},!0)}}}]).run(["decoratorService","personalizationsmarteditContextService","personalizationsmarteditContextServiceProxy","personalizationsmarteditContextModal","featureService","personalizationsmarteditUtils",function(a,b,c,d,e,f){new c("PersonalizationCtxGateway");a.addMappings({"^.*Component$":["personalizationsmarteditComponentLightUp"]}),e.addDecorator({key:"personalizationsmarteditComponentLightUp",nameI18nKey:"personalizationsmarteditComponentLightUp"}),e.addContextualMenuButton({key:"personalizationsmartedit.context.add.action",i18nKey:"personalization.context.add.action",nameI18nKey:"personalization.context.add.action",regexpKeys:["^.*Component$"],condition:function(a){return b.isContextualMenuAddItemEnabled(a.element)},callback:function(a,b){var c=angular.element(b.target);d.openAddAction(a.componentType,a.componentId,a.containerId,a.slotId,f.getActionIdForElement(c))},displayClass:"hyicon hyicon-remove",iconIdle:"/personalizationsmartedit/icons/contextualmenu_add_off.png",iconNonIdle:"/personalizationsmartedit/icons/contextualmenu_add_on.png",smallIcon:"hyicon hyicon-remove"}),e.addContextualMenuButton({key:"personalizationsmartedit.context.edit.action",i18nKey:"personalization.context.edit.action",nameI18nKey:"personalization.context.edit.action",regexpKeys:["^.*Component$"],condition:function(a){return b.isContextualMenuEditItemEnabled(a.element)},callback:function(a,b){var c=angular.element(b.target);d.openEditAction(a.componentType,a.componentId,a.containerId,a.slotId,f.getActionIdForElement(c))},displayClass:"hyicon hyicon-remove",iconIdle:"/personalizationsmartedit/icons/contextualmenu_edit_off.png",iconNonIdle:"/personalizationsmartedit/icons/contextualmenu_edit_on.png",smallIcon:"hyicon hyicon-remove"}),e.addContextualMenuButton({key:"personalizationsmartedit.context.delete.action",i18nKey:"personalization.context.delete.action",nameI18nKey:"personalization.context.delete.action",regexpKeys:["^.*Component$"],condition:function(a){return b.isContextualMenuDeleteItemEnabled(a.element)},callback:function(a,b){var c=angular.element(b.target);d.openDeleteAction(a.componentType,a.componentId,a.containerId,a.slotId,f.getActionIdForElement(c))},displayClass:"hyicon hyicon-remove",iconIdle:"/personalizationsmartedit/icons/contextualmenu_delete_off.png",iconNonIdle:"/personalizationsmartedit/icons/contextualmenu_delete_on.png",smallIcon:"hyicon hyicon-remove"}),e.addContextualMenuButton({key:"personalizationsmartedit.context.info.action",i18nKey:"personalization.context.info.action",nameI18nKey:"personalization.context.info.action",regexpKeys:["^.*Component$"],condition:function(a){return b.isContextualMenuInfoItemEnabled(a.element)},callback:function(a,b){d.openInfoAction()},displayClass:"hyicon hyicon-remove",iconIdle:"/personalizationsmartedit/icons/contextualmenu_info_off.png",iconNonIdle:"/personalizationsmartedit/icons/contextualmenu_info_on.png",smallIcon:"hyicon hyicon-remove"})}]),angular.module("personalizationsmarteditContextServiceModule",["personalizationsmarteditCommons"]).factory("personalizationsmarteditContextService",["personalizationsmarteditUtils","personalizationsmarteditContextServiceReverseProxy",function(a,b){var c={},d=new b("PersonalizationCtxReverseGateway"),e=function(){var a=c.personalizationEnabled;return a=a&&angular.isObject(c.selectedCustomizations),a=a&&angular.isObject(c.selectedVariations),a=a&&!angular.isArray(c.selectedVariations)},f=function(b){var d=a.getContainerIdForElement(b),e=$.inArray(d,c.selectedComponents)>-1;return e};return c.personalizationEnabled=!1,c.selectedCustomizations=null,c.selectedVariations=null,c.selectedComponents=null,c.seExperienceData=null,c.seConfigurationData=null,c.sePreviewData=null,c.pageId=null,c.isPersonalizationContextEnabled=function(){return c.personalizationEnabled},c.setPersonalizationContextEnabled=function(a){c.personalizationEnabled=a},c.setSelectedComponents=function(a){c.selectedComponents=a},c.setSelectedVariations=function(a){c.selectedVariations=a},c.setSelectedCustomizations=function(a){c.selectedCustomizations=a},c.isContextualMenuAddItemEnabled=function(a){return e()&&!f(a)},c.isContextualMenuEditItemEnabled=function(a){return e()&&f(a)},c.isContextualMenuDeleteItemEnabled=function(a){return e()&&f(a)},c.isContextualMenuInfoItemEnabled=function(a){var b=c.personalizationEnabled;return b=b&&!angular.isObject(c.selectedVariations),b=b||angular.isArray(c.selectedVariations)},c.applySynchronization=function(){d.applySynchronization()},c.getSeExperienceData=function(){return c.seExperienceData},c.setSeExperienceData=function(a){c.seExperienceData=a},c.getSeConfigurationData=function(){return c.seConfigurationData},c.setSeConfigurationData=function(a){c.seConfigurationData=a},c.getSePreviewData=function(){return c.sePreviewData},c.setSePreviewData=function(a){c.sePreviewData=a},c.setPageId=function(a){c.pageId=a,d.setPageId(a)},c.getPageId=function(){return c.pageId},c}]).factory("personalizationsmarteditContextServiceProxy",["gatewayProxy","personalizationsmarteditContextService",function(a,b){var c=function(b){this.gatewayId=b,a.initForService(this)};return c.prototype.setPersonalizationContextEnabled=function(a){b.setPersonalizationContextEnabled(a)},c.prototype.setSelectedComponents=function(a){b.setSelectedComponents(a)},c.prototype.setSelectedVariations=function(a){b.setSelectedVariations(a)},c.prototype.setSelectedCustomizations=function(a){b.setSelectedCustomizations(a)},c.prototype.setSeExperienceData=function(a){b.setSeExperienceData(a)},c.prototype.setSeConfigurationData=function(a){b.setSeConfigurationData(a)},c.prototype.setSePreviewData=function(a){b.setSePreviewData(a)},c}]).factory("personalizationsmarteditContextServiceReverseProxy",["gatewayProxy",function(a){var b=function(b){this.gatewayId=b,a.initForService(this)};return b.prototype.applySynchronization=function(){},b.prototype.setPageId=function(a){},b}]),angular.module("personalizationsmarteditTemplates",[]).run(["$templateCache",function(a){"use strict";a.put("web/features/personalizationsmartedit/componentLightUpDecorator/personalizationsmarteditComponentLightUpDecoratorTemplate.html",'<div ng-class="getPersonalizationComponentBorderClass()">\n    <div data-ng-transclude></div>\n</div>')}]);