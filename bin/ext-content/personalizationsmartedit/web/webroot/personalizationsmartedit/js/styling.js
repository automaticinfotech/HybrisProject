angular.module("personalizationsmarteditCommons",["alertServiceModule","commonsTemplates"]).factory("personalizationsmarteditUtils",function(){var a={};return a.pushToArrayIfValueExists=function(a,b,c){c&&a.push({key:b,value:c})},a.getContainerIdForElement=function(a){var b=a.closest('[data-smartedit-container-id][data-smartedit-container-type="CxCmsComponentContainer"]');return b.length?b.data().smarteditContainerId:null},a.getContainerIdForComponent=function(b,c){var d=angular.element('[data-smartedit-component-id="'+c+'"][data-smartedit-component-type="'+b+'"]');return angular.isArray(d)&&(d=d[0]),a.getContainerIdForElement(d)},a.getSlotIdForElement=function(a){var b=a.closest('[data-smartedit-component-type="ContentSlot"]');return b.length?b.data().smarteditComponentId:null},a.getSlotIdForComponent=function(b,c){var d=angular.element('[data-smartedit-component-id="'+c+'"][data-smartedit-component-type="'+b+'"]');return angular.isArray(d)&&(d=d[0]),a.getSlotIdForElement(d)},a.getVariationCodes=function(a){if("undefined"==typeof a||null===a)return[];var b=a.map(function(a){return a.code}).filter(function(a){return"undefined"!=typeof a});return b},a.getPageId=function(){return/page\-([\w]+)/.exec($("iframe").contents().find("body").attr("class"))[1]},a.getVariationKey=function(a,b){if(void 0===a||void 0===b)return[];var c=b.map(function(a){return a.code}).filter(function(a){return"undefined"!=typeof a}).map(function(b){return{variationCode:b,customizationCode:a}});return c},a.getSegmentTriggerForVariation=function(a){var b=a.triggers||[],c=b.filter(function(a){return"segmentTriggerData"===a.type});return 0===c.length?{}:c[0]},a.getActionIdForElement=function(a){var b=a.closest("[data-smartedit-personalization-action-id]");return b.length?b.data().smarteditPersonalizationActionId:null},a}).factory("personalizationsmarteditMessageHandler",["alertService",function(a){var b=function(b,c){a.pushAlerts([{successful:c,message:b}])},c={};return c.sendInformation=function(a){b(a,!0)},c.sendError=function(a){b(a,!1)},c}]),angular.module("personalizationsmarteditCommons").directive("personalizationInfiniteScroll",["$rootScope","$window","$timeout",function(a,b,c){return{link:function(d,e,f){var g,h,i,j;return b=angular.element(b),e.css("overflow-y","auto"),e.css("overflow-x","hidden"),e.css("height","inherit"),i=0,null!==f.personalizationInfiniteScrollDistance&&d.$watch(f.personalizationInfiniteScrollDistance,function(a){return i=parseInt(a,10)}),j=!0,g=!1,null!==f.personalizationInfiniteScrollDisabled&&d.$watch(f.personalizationInfiniteScrollDisabled,function(a){return j=!a,j&&g?(g=!1,h()):void 0}),a.$on("refreshStart",function(){e.animate({scrollTop:"0"})}),h=function(){var b,c,h,k,l;return b=$(e.children()[0]),c=e.offset().top+e.height(),l=b.offset().top+b.height(),h=l-c,k=h<=e.height()*i,k&&j?a.$$phase?d.$eval(f.personalizationInfiniteScroll):d.$apply(f.personalizationInfiniteScroll):k?g=!0:void 0},e.on("scroll",h),d.$on("$destroy",function(){return b.off("scroll",h)}),c(function(){return f.personalizationInfiniteScrollImmediateCheck?d.$eval(f.personalizationInfiniteScrollImmediateCheck)?h():void 0:h()},0)}}}]),angular.module("personalizationsmarteditCommons").directive("personalizationsmarteditPagination",function(){return{template:'<div ng-include="getContentUrl()"></div>',restrict:"E",scope:{callback:"=",pages:"=",currentPage:"=",pageSizes:"=",currentSize:"=",pagesOffset:"=",fixedPageSize:"="},link:function(a,b,c){a.callback||console.log("callback is undefined!"),a.pages=a.pages||[0,1,2],a.currentPage=a.currentPage||0,a.pageSizes=a.pageSizes||[5,10,25,50,100],a.currentSize=a.currentSize||10,a.pagesOffset=a.pagesOffset||2,a.fixedPageSize=a.fixedPageSize||!1,a.getContentUrl=function(){return c.template=c.template||"personalizationsmarteditPaginationTemplate.html","web/features/commons/personalizationsmarteditPagination/"+c.template},a.pageClick=function(b){a.currentPage!==b&&(a.currentPage=b,a.callback(a))},a.pageSizeClick=function(b){a.currentSize!==b&&(a.currentSize=b,a.currentPage=0,a.callback(a))},a.hasPrevious=function(){return a.currentPage>0},a.hasNext=function(){return a.currentPage<a.pages.length-1},a.isActive=function(b){return a.currentPage===b},a.nextClick=function(){a.hasNext()&&(a.currentPage++,a.callback(a))},a.prevClick=function(){a.hasPrevious()&&(a.currentPage--,a.callback(a))},a.pagesToDisplay=function(){var b=2*a.pagesOffset+1;if(a.pages.length<=b)return a.pages;var c=Math.max(a.currentPage-a.pagesOffset,0);return c+b>a.pages.length&&(c=a.pages.length-b),a.pages.slice(c,c+b)},a.availablePageSizes=function(){return a.pageSizes},a.getCurrentPageSize=function(){return a.currentSize},a.isFixedPageSize=function(){return a.fixedPageSize}}}}),angular.module("commonsTemplates",[]).run(["$templateCache",function(a){"use strict";a.put("web/features/commons/personalizationsmarteditPagination/personalizationsmarteditPaginationLefttoolbarTemplate.html",'<div class="row">\n\n    <div class="col-xs-12">\n        <ul class="pagination">\n            <li ng-click="prevClick()" ng-class="hasPrevious()?\'enabled\':\'disabled\'"><a>&laquo;</a></li>\n            <li ng-repeat="i in pagesToDisplay()"><a ng-click="pageClick(i)" ng-class="isActive({{i}})?\'active\':\'\'">{{i+1}}</a></li>\n            <li ng-click="nextClick()" ng-class="hasNext()?\'enabled\':\'disabled\'"><a>&raquo;</a></li>\n        </ul>\n    </div>\n</div>'),a.put("web/features/commons/personalizationsmarteditPagination/personalizationsmarteditPaginationTemplate.html",'<div class="row">\n    <div class="col-xs-4"></div>\n    <div class="col-xs-4">\n        <ul class="pagination pagination-lg">\n            <li ng-click="prevClick()" ng-class="hasPrevious()?\'enabled\':\'disabled\'"><a>&laquo;</a></li>\n            <li ng-repeat="i in pagesToDisplay()"><a ng-click="pageClick(i)" ng-class="isActive({{i}})?\'active\':\'\'">{{i+1}}</a></li>\n            <li ng-click="nextClick()" ng-class="hasNext()?\'enabled\':\'disabled\'"><a>&raquo;</a></li>\n        </ul>\n    </div>\n    <div class="col-xs-2"></div>\n    <div class="col-xs-2" ng-if="!isFixedPageSize()">\n        <button type="button" class="btn btn-link dropdown-toggle pull-right" data-toggle="dropdown">\n            <span ng-bind="getCurrentPageSize()"></span>\n            <span data-translate="personalization.pagination.rowsperpage"></span>\n            <span class="hyicon hyicon-arrow"></span>\n        </button>\n        <ul class="dropdown-menu pull-right text-left" role="menu">\n            <li ng-repeat="i in availablePageSizes() track by $index"><a ng-click="pageSizeClick(i)">{{i}}</a></li>\n        </ul>\n    </div>\n</div>')}]);