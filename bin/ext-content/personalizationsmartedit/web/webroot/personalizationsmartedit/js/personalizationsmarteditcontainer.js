angular.module("personalizationsmarteditCommons",["alertServiceModule","commonsTemplates"]).factory("personalizationsmarteditUtils",function(){var a={};return a.pushToArrayIfValueExists=function(a,b,c){c&&a.push({key:b,value:c})},a.getContainerIdForElement=function(a){var b=a.closest('[data-smartedit-container-id][data-smartedit-container-type="CxCmsComponentContainer"]');return b.length?b.data().smarteditContainerId:null},a.getContainerIdForComponent=function(b,c){var d=angular.element('[data-smartedit-component-id="'+c+'"][data-smartedit-component-type="'+b+'"]');return angular.isArray(d)&&(d=d[0]),a.getContainerIdForElement(d)},a.getSlotIdForElement=function(a){var b=a.closest('[data-smartedit-component-type="ContentSlot"]');return b.length?b.data().smarteditComponentId:null},a.getSlotIdForComponent=function(b,c){var d=angular.element('[data-smartedit-component-id="'+c+'"][data-smartedit-component-type="'+b+'"]');return angular.isArray(d)&&(d=d[0]),a.getSlotIdForElement(d)},a.getVariationCodes=function(a){if("undefined"==typeof a||null===a)return[];var b=a.map(function(a){return a.code}).filter(function(a){return"undefined"!=typeof a});return b},a.getPageId=function(){return/page\-([\w]+)/.exec($("iframe").contents().find("body").attr("class"))[1]},a.getVariationKey=function(a,b){if(void 0===a||void 0===b)return[];var c=b.map(function(a){return a.code}).filter(function(a){return"undefined"!=typeof a}).map(function(b){return{variationCode:b,customizationCode:a}});return c},a.getSegmentTriggerForVariation=function(a){var b=a.triggers||[],c=b.filter(function(a){return"segmentTriggerData"===a.type});return 0===c.length?{}:c[0]},a.getActionIdForElement=function(a){var b=a.closest("[data-smartedit-personalization-action-id]");return b.length?b.data().smarteditPersonalizationActionId:null},a}).factory("personalizationsmarteditMessageHandler",["alertService",function(a){var b=function(b,c){a.pushAlerts([{successful:c,message:b}])},c={};return c.sendInformation=function(a){b(a,!0)},c.sendError=function(a){b(a,!1)},c}]),angular.module("personalizationsmarteditCommons").directive("personalizationInfiniteScroll",["$rootScope","$window","$timeout",function(a,b,c){return{link:function(d,e,f){var g,h,i,j;return b=angular.element(b),e.css("overflow-y","auto"),e.css("overflow-x","hidden"),e.css("height","inherit"),i=0,null!==f.personalizationInfiniteScrollDistance&&d.$watch(f.personalizationInfiniteScrollDistance,function(a){return i=parseInt(a,10)}),j=!0,g=!1,null!==f.personalizationInfiniteScrollDisabled&&d.$watch(f.personalizationInfiniteScrollDisabled,function(a){return j=!a,j&&g?(g=!1,h()):void 0}),a.$on("refreshStart",function(){e.animate({scrollTop:"0"})}),h=function(){var b,c,h,k,l;return b=$(e.children()[0]),c=e.offset().top+e.height(),l=b.offset().top+b.height(),h=l-c,k=h<=e.height()*i,k&&j?a.$$phase?d.$eval(f.personalizationInfiniteScroll):d.$apply(f.personalizationInfiniteScroll):k?g=!0:void 0},e.on("scroll",h),d.$on("$destroy",function(){return b.off("scroll",h)}),c(function(){return f.personalizationInfiniteScrollImmediateCheck?d.$eval(f.personalizationInfiniteScrollImmediateCheck)?h():void 0:h()},0)}}}]),angular.module("personalizationsmarteditCommons").directive("personalizationsmarteditPagination",function(){return{template:'<div ng-include="getContentUrl()"></div>',restrict:"E",scope:{callback:"=",pages:"=",currentPage:"=",pageSizes:"=",currentSize:"=",pagesOffset:"=",fixedPageSize:"="},link:function(a,b,c){a.callback||console.log("callback is undefined!"),a.pages=a.pages||[0,1,2],a.currentPage=a.currentPage||0,a.pageSizes=a.pageSizes||[5,10,25,50,100],a.currentSize=a.currentSize||10,a.pagesOffset=a.pagesOffset||2,a.fixedPageSize=a.fixedPageSize||!1,a.getContentUrl=function(){return c.template=c.template||"personalizationsmarteditPaginationTemplate.html","web/features/commons/personalizationsmarteditPagination/"+c.template},a.pageClick=function(b){a.currentPage!==b&&(a.currentPage=b,a.callback(a))},a.pageSizeClick=function(b){a.currentSize!==b&&(a.currentSize=b,a.currentPage=0,a.callback(a))},a.hasPrevious=function(){return a.currentPage>0},a.hasNext=function(){return a.currentPage<a.pages.length-1},a.isActive=function(b){return a.currentPage===b},a.nextClick=function(){a.hasNext()&&(a.currentPage++,a.callback(a))},a.prevClick=function(){a.hasPrevious()&&(a.currentPage--,a.callback(a))},a.pagesToDisplay=function(){var b=2*a.pagesOffset+1;if(a.pages.length<=b)return a.pages;var c=Math.max(a.currentPage-a.pagesOffset,0);return c+b>a.pages.length&&(c=a.pages.length-b),a.pages.slice(c,c+b)},a.availablePageSizes=function(){return a.pageSizes},a.getCurrentPageSize=function(){return a.currentSize},a.isFixedPageSize=function(){return a.fixedPageSize}}}}),angular.module("commonsTemplates",[]).run(["$templateCache",function(a){"use strict";a.put("web/features/commons/personalizationsmarteditPagination/personalizationsmarteditPaginationLefttoolbarTemplate.html",'<div class="row">\n\n    <div class="col-xs-12">\n        <ul class="pagination">\n            <li ng-click="prevClick()" ng-class="hasPrevious()?\'enabled\':\'disabled\'"><a>&laquo;</a></li>\n            <li ng-repeat="i in pagesToDisplay()"><a ng-click="pageClick(i)" ng-class="isActive({{i}})?\'active\':\'\'">{{i+1}}</a></li>\n            <li ng-click="nextClick()" ng-class="hasNext()?\'enabled\':\'disabled\'"><a>&raquo;</a></li>\n        </ul>\n    </div>\n</div>'),a.put("web/features/commons/personalizationsmarteditPagination/personalizationsmarteditPaginationTemplate.html",'<div class="row">\n    <div class="col-xs-4"></div>\n    <div class="col-xs-4">\n        <ul class="pagination pagination-lg">\n            <li ng-click="prevClick()" ng-class="hasPrevious()?\'enabled\':\'disabled\'"><a>&laquo;</a></li>\n            <li ng-repeat="i in pagesToDisplay()"><a ng-click="pageClick(i)" ng-class="isActive({{i}})?\'active\':\'\'">{{i+1}}</a></li>\n            <li ng-click="nextClick()" ng-class="hasNext()?\'enabled\':\'disabled\'"><a>&raquo;</a></li>\n        </ul>\n    </div>\n    <div class="col-xs-2"></div>\n    <div class="col-xs-2" ng-if="!isFixedPageSize()">\n        <button type="button" class="btn btn-link dropdown-toggle pull-right" data-toggle="dropdown">\n            <span ng-bind="getCurrentPageSize()"></span>\n            <span data-translate="personalization.pagination.rowsperpage"></span>\n            <span class="hyicon hyicon-arrow"></span>\n        </button>\n        <ul class="dropdown-menu pull-right text-left" role="menu">\n            <li ng-repeat="i in availablePageSizes() track by $index"><a ng-click="pageSizeClick(i)">{{i}}</a></li>\n        </ul>\n    </div>\n</div>')}]),angular.module("personalizationsmarteditContextMenu",["modalServiceModule","personalizationsmarteditRestServiceModule","personalizationsmarteditCommons","ui.select","genericEditorModule","editorModalServiceModule","gatewayProxyModule","personalizationsmarteditContextServiceModule","personalizationsmarteditcontainermodule"]).factory("personalizationsmarteditContextModal",["$controller","modalService","MODAL_BUTTON_ACTIONS","MODAL_BUTTON_STYLES","$filter","personalizationsmarteditMessageHandler","gatewayProxy","personalizationsmarteditContextService","personalizationsmarteditIFrameUtils",function(a,b,c,d,e,f,g,h,i){var j=function(){this.gatewayId="personalizationsmarteditContextModal",g.initForService(this)},k=[{id:"cancel",label:"personalization.modal.button.cancel",style:d.SECONDARY,action:c.DISMISS},{id:"submit",label:"personalization.modal.button.submit",action:c.CLOSE}];return j.prototype.openDeleteAction=function(e,f,g,j,k){b.open({size:"md",title:"personalization.modal.deleteaction.title",templateInline:'<div id="confirmationModalDescription">{{ "personalization.modal.deleteaction.content" | translate }}</div>',controller:["$scope","modalManager",function(b,c){b.componentType=e,b.componentId=f,b.actionId=k,b.modalManager=c,angular.extend(this,a("modalDeleteActionController",{$scope:b}))}],buttons:[{id:"confirmCancel",label:"personalization.modal.button.cancel",style:d.SECONDARY,action:c.DISMISS},{id:"confirmOk",label:"personalization.modal.button.ok",action:c.CLOSE}]}).then(function(a){var b=h.getSePreviewData();i.reloadPreview(b.resourcePath,b.previewTicketId),h.selectedComponents.splice(h.selectedComponents.indexOf(g),1)})},j.prototype.openAddAction=function(c,d,e,f,g){b.open({title:"personalization.modal.addaction.title",templateUrl:"web/features/personalizationsmarteditcontainer/contextMenu/personalizationsmarteditAddEditActionTemplate.html",controller:["$scope","modalManager",function(b,h){b.componentType=c,b.componentId=d,b.containerId=e,b.slotId=f,b.actionId=g,b.modalManager=h,b.editEnabled=!1,angular.extend(this,a("modalAddEditActionController",{$scope:b})),angular.extend(this,a("modalAddActionController",{$scope:b}))}],buttons:k}).then(function(a){var b=h.getSePreviewData();i.reloadPreview(b.resourcePath,b.previewTicketId),h.selectedComponents.push(a)},function(a){})},j.prototype.openEditAction=function(c,d,e,f,g){b.open({title:"personalization.modal.editaction.title",templateUrl:"web/features/personalizationsmarteditcontainer/contextMenu/personalizationsmarteditAddEditActionTemplate.html",controller:["$scope","modalManager",function(b,h){b.componentType=c,b.componentId=d,b.containerId=e,b.slotId=f,b.actionId=g,b.modalManager=h,b.editEnabled=!0,angular.extend(this,a("modalAddEditActionController",{$scope:b})),angular.extend(this,a("modalEditActionController",{$scope:b}))}],buttons:k}).then(function(a){var b=h.getSePreviewData();i.reloadPreview(b.resourcePath,b.previewTicketId)})},j.prototype.openInfoAction=function(){f.sendError(e("translate")("personalization.modal.infoaction.content"))},new j}]).factory("PaginationHelper",function(){return PaginationHelper=function(a){a=a||{},this.count=a.count||0,this.page=a.page||0,this.totalCount=a.totalCount||0,this.totalPages=a.totalPages||0,this.reset=function(){this.count=10,this.page=-1,this.totalPages=1}},PaginationHelper}).controller("modalAddEditActionController",["$scope","$filter","$q","$timeout","editorModalService","personalizationsmarteditContextService","personalizationsmarteditRestService","personalizationsmarteditMessageHandler","PaginationHelper",function(a,b,c,d,e,f,g,h,i){a.actions=[{id:"create",name:b("translate")("personalization.modal.addeditaction.createnewcomponent")},{id:"use",name:b("translate")("personalization.modal.addeditaction.usecomponent")}],a.newComponent={},a.component={},a.components=[],a.newComponentTypes=[];var j=function(){g.getNewComponentTypes().then(function(b){a.newComponentTypes=b.componentTypes},function(a){h.sendError(b("translate")("personalization.error.gettingcomponentstypes"))})},k=function(c){g.getComponent(c).then(function(b){a.component.selected=b},function(a){h.sendError(b("translate")("personalization.error.gettingcomponents"))})};a.newComponentTypeSelectedEvent=function(c,d){g.createComponent("name",a.newComponent.selected.code,f.getPageId(),null).then(function(c){var d=c.uid,f={render:!1};e.open(c.typeCode,d,f).then(function(c){a.componentId=c.uid,k(a.componentId),a.action={selected:b("filter")(a.actions,{id:"use"},!0)[0]}},function(c){a.newComponent={},g.removeComponent(d,a.slotId).then(function(){},function(){h.sendError(b("translate")("personalization.error.removingcomponent"))})})},function(){h.sendError(b("translate")("personalization.error.creatingcomponent"))})};var l=function(a,d,e,f){var i=c.defer();return g.editAction(a,d,e,f).then(function(a){h.sendInformation(b("translate")("personalization.info.updatingaction")),i.resolve()},function(a){h.sendError(b("translate")("personalization.error.updatingaction")),i.reject()}),i.promise},m=function(a,d,e,f){var i=c.defer();return g.addActionToContainer(a,d,e,f).then(function(a){h.sendInformation(b("translate")("personalization.info.creatingaction")),i.resolve(d)},function(a){h.sendError(b("translate")("personalization.error.creatingaction")),i.reject()}),i.promise},n=function(d){return"submit"===d?a.editEnabled?l(a.selectedCustomization.code,a.selectedVariation.code,a.actionId,a.component.selected.uid):a.containerId?m(a.component.selected.uid,a.containerId,a.selectedCustomization.code,a.selectedVariation.code):g.replaceComponentWithContainer(a.componentId,a.slotId).then(function(b){return m(a.component.selected.uid,b.uid,a.selectedCustomization.code,a.selectedVariation.code)},function(a){return h.sendError(b("translate")("personalization.error.replacingcomponent")),c.defer().reject()}):c.defer().reject()};a.modalManager.setButtonHandler(n),a.componentFilter={name:""};var o=function(){return{currentPage:a.componentPagination.page+1,mask:a.componentFilter.name,pageSize:100,sort:"name"}};a.componentPagination=new i,a.componentPagination.reset(),a.moreComponentRequestProcessing=!1,a.addMoreComponentItems=function(){a.componentPagination.page<a.componentPagination.totalPages-1&&!a.moreComponentRequestProcessing&&(a.moreComponentRequestProcessing=!0,g.getComponents(o()).then(function(b){var c=b.componentItems.filter(function(b){return a.newComponentTypes.some(function(a,c,d){return b.typeCode===a.code})});Array.prototype.push.apply(a.components,c),a.componentPagination=new i(b.pagination),a.moreComponentRequestProcessing=!1,a.components.length<20&&d(function(){a.addMoreComponentItems()},0)},function(c){h.sendError(b("translate")("personalization.error.gettingcomponents")),a.moreComponentRequestProcessing=!1}))},a.componentSearchInputKeypress=function(b,c){b&&[37,38,39,40].indexOf(b.which)>-1||(a.componentPagination.reset(),a.componentFilter.name=c,a.components.length=0,a.addMoreComponentItems())},a.$watch("action.selected",function(b,c){b!==c&&(a.component.selected=void 0,a.editEnabled&&k(a.componentId))},!0),a.$watch("component.selected",function(b,c){a.modalManager.disableButton("submit"),void 0!==b&&a.modalManager.enableButton("submit")},!0),function(){a.selectedCustomization=f.selectedCustomizations,a.selectedVariation=f.selectedVariations,a.editEnabled&&k(a.componentId),j()}()}]).controller("modalAddActionController",["$scope",function(a){a.action={}}]).controller("modalEditActionController",["$scope","$filter",function(a,b){a.action={selected:b("filter")(a.actions,{id:"use"},!0)[0]}}]).controller("modalDeleteActionController",["$scope","$q","personalizationsmarteditContextService","personalizationsmarteditRestService",function(a,b,c,d){var e=function(c){return"confirmOk"===c?d.deleteAction(a.selectedCustomization.code,a.selectedVariation.code,a.actionId):b.defer().reject()};a.modalManager.setButtonHandler(e),function(){a.selectedVariation=c.selectedVariations,a.selectedCustomization=c.selectedCustomizations}()}]),angular.module("personalizationsmarteditManagerViewModule",["modalServiceModule","personalizationsmarteditCommons","personalizationsmarteditRestServiceModule","personalizationsmarteditContextServiceModule","confirmationModalServiceModule","personalizationsmarteditManagerModule","eventServiceModule"]).factory("personalizationsmarteditManagerView",["modalService","MODAL_BUTTON_ACTIONS","MODAL_BUTTON_STYLES",function(a,b,c){var d={};return d.openManagerAction=function(){a.open({title:"personalization.manager.modal.title",templateUrl:"web/features/personalizationsmarteditcontainer/management/managerView/personalizationsmarteditManagerViewTemplate.html",controller:"personalizationsmarteditManagerViewController",size:"fullscreen",cssClasses:"manage-customization"}).then(function(a){},function(a){})},d}]).controller("personalizationsmarteditManagerViewController",["$q","$scope","$filter","$timeout","confirmationModalService","personalizationsmarteditRestService","personalizationsmarteditMessageHandler","personalizationsmarteditContextService","personalizationsmarteditManager","systemEventService",function(a,b,c,d,e,f,g,h,i,j){var k=function(a){f.getCustomizations(a).then(function(a){b.isUndefined(b.allCustomizationsCount)&&(b.allCustomizationsCount=a.pagination.totalCount),b.customizations=a.customizations||[],b.filteredCustomizationsCount=a.pagination.totalCount,b.pagination.currentPage=a.pagination.page,b.pagination.pages=Array(a.pagination.totalPages).join().split(",").map(function(a,b){return b})},function(){g.sendError(c("translate")("personalization.error.gettingcustomizations"))})},l=function(a,d){f.getCustomization(a.code).then(function(c){a.variations=c.variations,b.customizationClickAction(a)},function(){g.sendError(c("translate")("personalization.error.gettingcustomization"))})},m=function(){return{name:b.search.name,currentSize:b.pagination.currentSize,currentPage:b.pagination.currentPage}},n=function(){d(function(){k(m())},0)},o=h.getSeExperienceData().languageDescriptor.isocode;b.catalogName=h.getSeExperienceData().catalogDescriptor.name[o],b.catalogName+=" - "+h.getSeExperienceData().catalogDescriptor.catalogVersion,b.customizations=[],b.allCustomizationsCount=void 0,b.filteredCustomizationsCount=0,b.search={name:""},b.pagination={},b.searchInputKeypress=function(a){(13===a.which||b.search.name.length>2||0===b.search.name.length)&&(b.pagination.currentPage=0,n())},b.resetSearchInput=function(){b.search.name="",n()},b.editCustomizationAction=function(a){i.openEditCustomizationModal(a.code)},b.deleteCustomizationAction=function(a){e.confirm({description:"personalization.manager.modal.deletecustomization.content"}).then(function(){f.deleteCustomization(a.code).then(function(c){b.customizations.splice(b.customizations.indexOf(a),1)},function(){g.sendError(c("translate")("personalization.error.deletingcustomization"))})})},b.editVariationAction=function(a,b){i.openEditCustomizationModal(a.code,b.code)},b.deleteVariationAction=function(a,b,d){a.variations.length>=2?e.confirm({description:"personalization.manager.modal.deletevariation.content"}).then(function(){f.deleteVariation(a.code,b.code).then(function(c){a.variations.splice(a.variations.indexOf(b),1)},function(){g.sendError(c("translate")("personalization.error.deletingvariation"))})}):d.stopPropagation()},b.openNewModal=function(){i.openCreateCustomizationModal()},b.paginationCallback=function(){n()},b.setCustomizationRank=function(a,d,e,h){b.isFilterEnabled()||h?e.stopPropagation():f.getCustomization(a.code).then(function(a){a.rank=a.rank+d,f.updateCustomization(a).then(function(){n()},function(){g.sendError(c("translate")("personalization.error.updatingcustomization"))})},function(){g.sendError(c("translate")("personalization.error.gettingcustomization"))})},b.setVariationRank=function(a,b,d,e,h){h?e.stopPropagation():f.getVariation(a.code,b.code).then(function(b){b.rank=b.rank+d,f.editVariation(a.code,b).then(function(){l(a)},function(){g.sendError(c("translate")("personalization.error.editingvariation"))})},function(){g.sendError(c("translate")("personalization.error.gettingvariation"))})},b.isUndefined=function(a){return void 0===a},b.isFilterEnabled=function(){return b.filteredCustomizationsCount<b.allCustomizationsCount},b.customizationClickAction=function(a){var b={includeActions:!0};f.getVariationsForCustomization(a.code,b).then(function(b){a.variations=b.variations||[],a.variations.forEach(function(a){a.numberOfComponents=(a.actions||[]).length})},function(){g.sendError(c("translate")("personalization.error.gettingcustomization"))})},j.registerEventHandler("CUSTOMIZATIONS_MODIFIED",function(){return n(),a.when()}),n()}]),angular.module("personalizationsmarteditManagerModule",["modalServiceModule","coretemplates","ui.select","confirmationModalServiceModule","functionsModule","personalizationsmarteditCommons","personalizationsmarteditManagementServiceModule","eventServiceModule"]).constant("CUSTOMIZATION_VARIATION_MANAGEMENT_TABS_CONSTANTS",{BASIC_INFO_TAB_NAME:"basicinfotab",BASIC_INFO_TAB_FORM_NAME:"form.basicinfotab",TARGET_GROUP_TAB_NAME:"targetgrptab",TARGET_GROUP_TAB_FORM_NAME:"form.targetgrptab"}).constant("CUSTOMIZATION_VARIATION_MANAGEMENT_BUTTONS",{CONFIRM_OK:"confirmOk",CONFIRM_CANCEL:"confirmCancel",CONFIRM_NEXT:"confirmNext"}).constant("CUSTOMIZATION_VARIATION_MANAGEMENT_SEGMENTTRIGGER_GROUPBY",{CRITERIA_AND:"AND",CRITERIA_OR:"OR"}).factory("personalizationsmarteditManager",["$controller","modalService","MODAL_BUTTON_ACTIONS","MODAL_BUTTON_STYLES","CUSTOMIZATION_VARIATION_MANAGEMENT_BUTTONS",function(a,b,c,d,e){var f={};return f.openCreateCustomizationModal=function(){return b.open({title:"personalization.modal.customizationvariationmanagement.title",templateUrl:"web/features/personalizationsmarteditcontainer/management/personalizationsmarteditCustomizationManagTemplate.html",controller:["$scope","modalManager",function(b,c){b.modalManager=c,angular.extend(this,a("personalizationsmarteditManagerController",{$scope:b}))}],buttons:[{id:e.CONFIRM_CANCEL,label:"personalization.modal.button.cancel",style:d.SECONDARY}],size:"lg modal_bigger"})},f.openEditCustomizationModal=function(c,e){return b.open({title:"personalization.modal.customizationvariationmanagement.title",templateUrl:"web/features/personalizationsmarteditcontainer/management/personalizationsmarteditCustomizationManagTemplate.html",controller:["$scope","modalManager",function(b,d){b.customizationCode=c,b.variationCode=e,b.modalManager=d,angular.extend(this,a("personalizationsmarteditManagerController",{$scope:b}))}],buttons:[{id:"confirmCancel",label:"personalization.modal.button.cancel",style:d.SECONDARY}],size:"lg modal_bigger"})},f}]).controller("personalizationsmarteditManagerController",["$scope","hitch","$q","$log","$timeout","personalizationsmarteditManagementService","personalizationsmarteditMessageHandler","personalizationsmarteditUtils","confirmationModalService","$filter","MODAL_BUTTON_ACTIONS","CUSTOMIZATION_VARIATION_MANAGEMENT_TABS_CONSTANTS","CUSTOMIZATION_VARIATION_MANAGEMENT_BUTTONS","systemEventService","CUSTOMIZATION_VARIATION_MANAGEMENT_SEGMENTTRIGGER_GROUPBY",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=this,q=function(a){var b={includeTriggers:!0};return f.getVariationsForCustomization(a,b)};p.isModallDirty=!1,a.form={},a.customization={code:"",description:"",rank:0,variations:[]},a.tabsArr=[{name:l.BASIC_INFO_TAB_NAME,active:!0,disabled:!1,heading:j("translate")("personalization.modal.customizationvariationmanagement.basicinformationtab"),template:"web/features/personalizationsmarteditcontainer/management/tabs/personalizationsmarteditCustVarManagBasicInfoTemplate.html",formName:l.BASIC_INFO_TAB_FORM_NAME,isDirty:function(){return a.form.basicinfotab&&a.form.basicinfotab.$dirty},setPristine:function(){a.form.basicinfotab.$setPristine()},isValid:function(){return a.form.basicinfotab&&a.form.basicinfotab.$valid},setEnabled:function(b){b?(a.tabsArr[1].disabled=!1,a.modalManager.enableButton(m.CONFIRM_NEXT)):(a.tabsArr[1].disabled=!0,a.modalManager.disableButton(m.CONFIRM_NEXT))},onConfirm:function(){a.tabsArr[1].active=!0},onCancel:function(){p.onCancel()}},{name:l.TARGET_GROUP_TAB_NAME,active:!1,disabled:!0,heading:j("translate")("personalization.modal.customizationvariationmanagement.targetgrouptab"),template:"web/features/personalizationsmarteditcontainer/management/tabs/personalizationsmarteditCustVarManagTargetGrpTemplate.html",formName:l.TARGET_GROUP_TAB_FORM_NAME,isDirty:function(){return a.form.targetgrptab&&a.form.targetgrptab.$dirty||a.edit.variationsListDirty},setPristine:function(){a.form.targetgrptab.$setPristine()},isValid:function(){var b=a.customization.variations.length>0;return a.form.targetgrptab&&a.form.targetgrptab.$valid&&b},setEnabled:function(b){b?a.modalManager.enableButton(m.CONFIRM_OK):a.modalManager.disableButton(m.CONFIRM_OK)},onConfirm:function(){p.onSave()},onCancel:function(){p.onCancel()}}],a.edit={code:"",name:"",segments:[],selectedSegments:[],allSegmentsChecked:!0,variationsListChanged:!1,selectedTab:a.tabsArr[0],variationsLoaded:!1},a.editMode=angular.isDefined(a.customizationCode),a.editMode&&f.getCustomization(a.customizationCode).then(function(b){a.customization=b,angular.isDefined(a.variationCode)?q(a.customizationCode).then(function(b){a.customization.variations=b.variations,a.edit.variationsLoaded=!0;var c=a.customization.variations.filter(function(b){return b.code===a.variationCode});if(c.length>0){a.tabsArr[1].active=!0,a.edit.selectedTab=a.tabsArr[1];var d=c[0];a.edit.selectedVariation=d}},function(a){g.sendError(j("translate")("personalization.error.gettingsegments"))}):a.edit.selectedTab=a.tabsArr[0]},function(a){g.sendError(j("translate")("personalization.error.gettingcomponents"))}),a.selectTab=function(b){switch(a.edit.selectedTab=b,b.active=!0,b.name){case l.BASIC_INFO_TAB_NAME:a.modalManager.removeButton(m.CONFIRM_OK),a.modalManager.addButton({id:m.CONFIRM_NEXT,label:"personalization.modal.button.next"});break;case l.TARGET_GROUP_TAB_NAME:a.modalManager.removeButton(m.CONFIRM_NEXT),a.modalManager.addButton({id:m.CONFIRM_OK,label:"personalization.modal.button.submit",action:k.CLOSE})}},p.onSave=function(){a.editMode?f.updateCustomizationPackage(a.customization).then(function(a){n.sendSynchEvent("CUSTOMIZATIONS_MODIFIED",{}),g.sendInformation(j("translate")("personalization.info.updatingcustomization"))},function(a){g.sendError(j("translate")("personalization.error.updatingcustomization"))}):f.createCustomization(a.customization).then(function(a){n.sendSynchEvent("CUSTOMIZATIONS_MODIFIED",{}),g.sendInformation(j("translate")("personalization.info.creatingcustomization"))},function(a){g.sendError(j("translate")("personalization.error.creatingcustomization"))})},p.onCancel=function(){var b=c.defer();return this.isModallDirty?i.confirm({description:j("translate")("personalization.modal.customizationvariationmanagement.targetgrouptab.cancelconfirmation")}).then(function(){a.modalManager.dismiss(),b.resolve()},function(){b.reject()}):(a.modalManager.dismiss(),b.resolve()),b.promise};var r=function(a){var b=h.getSegmentTriggerForVariation(a);return b.groupBy===o.CRITERIA_AND};p.init=function(){a.modalManager.setDismissCallback(b(this,this.onCancel)),a.modalManager.setButtonHandler(b(this,function(b){switch(b){case m.CONFIRM_OK:return a.edit.selectedTab.onConfirm();case m.CONFIRM_NEXT:return a.edit.selectedTab.onConfirm();case m.CONFIRM_CANCEL:return a.edit.selectedTab.onCancel();default:d.error(j("translate")("personalization.modal.customizationvariationmanagement.targetgrouptab.invalidbuttonid"),b)}})),a.$watch(b(this,function(){var b=a.edit.selectedTab.isDirty(),c=a.edit.selectedTab.isValid();return{isDirty:b,isValid:c}}),b(this,function(b){b.isDirty?(p.isModallDirty=!0,a.edit.selectedTab.setEnabled(b.isValid?!0:!1)):a.editMode?a.edit.selectedTab.setEnabled(b.isValid?!0:!1):(p.isModallDirty=!1,a.edit.selectedTab.setEnabled(!1))}),!0),a.$watch("customization.variations",function(){a.edit.variationsListDirty=!0},!0),a.$watch("edit.selectedVariation",function(b){b?(a.edit.code=b.code,a.edit.name=b.name,a.edit.selectedSegments=h.getSegmentTriggerForVariation(b).segments,a.edit.allSegmentsChecked=r(b)):(a.edit.code="",a.edit.name="",a.edit.selectedSegments=[],a.edit.allSegmentsChecked=!0)},!0),a.$watch("edit.selectedTab",function(){a.editMode&&!a.edit.variationsLoaded&&a.edit.selectedTab&&a.edit.selectedTab.name===l.TARGET_GROUP_TAB_NAME&&q(a.customizationCode).then(function(b){a.customization.variations=b.variations,a.edit.variationsLoaded=!0},function(a){g.sendError(j("translate")("personalization.error.gettingsegments"))})},!0)}}]).directive("negate",[function(){return{require:"ngModel",link:function(a,b,c,d){d.$isEmpty=function(a){return!!a},d.$formatters.unshift(function(a){return!a}),d.$parsers.unshift(function(a){return!a})}}}]).directive("uniquetargetgroupname",["isBlank",function(a){var b=function(a,b){return a.edit.selectedVariation&&b===a.edit.selectedVariation.code};return{restrict:"A",require:"ngModel",scope:!1,link:function(c,d,e,f){f.$validators.uniquetargetgroupname=function(d){return a(d)||b(c,d)?!0:0===c.customization.variations.filter(function(a){return a.code===d}).length}}}}]),angular.module("personalizationsmarteditManagementServiceModule",["personalizationsmarteditRestServiceModule","sharedDataServiceModule","personalizationsmarteditCommons","personalizationsmarteditContextServiceModule"]).factory("personalizationsmarteditManagementService",["personalizationsmarteditRestService",function(a){var b=function(){};return b.getSegments=function(b){return a.getSegments(b)},b.getCustomization=function(b){return a.getCustomization(b)},b.getVariation=function(b,c){return a.getVariation(b,c)},b.createCustomization=function(b){return a.createCustomization(b)},b.updateCustomizationPackage=function(b){return a.updateCustomizationPackage(b)},b.createVariationForCustomization=function(b,c){return a.createVariationForCustomization(b,c)},b.getVariationsForCustomization=function(b,c){return a.getVariationsForCustomization(b,c)},b}]),angular.module("ui.select").run(["$templateCache",function(a){a.put("select2personalization/choices.tpl.html",a.get("select2/choices.tpl.html"));var b=a.get("select2/match-multiple.tpl.html").replace("$item in $select.selected","$item in $select.selected track by $index");a.put("select2personalization/match-multiple.tpl.html",b),a.put("select2personalization/match.tpl.html",a.get("select2/match.tpl.html")),a.put("select2personalization/select-multiple.tpl.html",a.get("select2/select-multiple.tpl.html")),a.put("select2personalization/select.tpl.html",a.get("select2/select.tpl.html"))}]),angular.module("personalizationsmarteditManagerModule").controller("personalizationsmarteditManagerTargetGrpController",["$scope","isBlank","$filter","personalizationsmarteditUtils","personalizationsmarteditManagementService","personalizationsmarteditMessageHandler","confirmationModalService","CUSTOMIZATION_VARIATION_MANAGEMENT_SEGMENTTRIGGER_GROUPBY",function(a,b,c,d,e,f,g,h){var i=function(a){return a?h.CRITERIA_AND:h.CRITERIA_OR};a.addVariationClick=function(){a.customization.variations.push({name:a.edit.name,enabled:!0,triggers:[{type:"segmentTriggerData",groupBy:i(a.edit.allSegmentsChecked),segments:a.edit.selectedSegments}],allSegmentsCriteria:a.edit.allSegmentsChecked,rank:a.customization.variations.length,isNew:!0}),a.edit.name="",a.edit.selectedSegments=[],k(),l()},a.submitChangesClick=function(){a.edit.selectedVariation.triggers=a.edit.selectedVariation.triggers||[];var b=a.edit.selectedVariation.triggers.filter(function(a){return"segmentTriggerData"===a.type});0===b.length&&a.edit.selectedSegments.length>0&&a.edit.selectedVariation.triggers.push({type:"segmentTriggerData",groupBy:"",segments:[]}),a.edit.selectedVariation.name=a.edit.name;var c=d.getSegmentTriggerForVariation(a.edit.selectedVariation);c.segments=a.edit.selectedSegments,c.groupBy=i(a.edit.allSegmentsChecked),a.edit.selectedVariation.allSegmentsCriteria=a.edit.allSegmentsChecked,a.edit.selectedVariation=void 0},a.cancelChangesClick=function(){a.edit.selectedVariation=void 0},a.removeVariationClick=function(b){g.confirm({description:"personalization.manager.modal.deletevariation.content"}).then(function(){a.customization.variations.splice(a.customization.variations.indexOf(b),1),a.edit.selectedVariation=void 0})},a.setVariationRank=function(b,c,d,e){if(e)d.stopPropagation();else{var f=a.customization.variations.indexOf(b),g=f+c,h=a.customization.variations;g>=0&&g<h.length&&(h.splice(g,0,h.splice(f,1)[0]),a.recalculateRanksForVariations())}},a.recalculateRanksForVariations=function(){a.customization.variations.forEach(function(b,c){a.customization.variations[c].rank=c+1})},a.canShowVariationSegmentationCriteria=function(){return a.edit.selectedSegments&&a.edit.selectedSegments.length>1},a.editVariationAction=function(b){a.edit.selectedVariation=b},a.canSaveVariation=function(){return a.edit.selectedSegments&&a.edit.selectedSegments.length>0&&!b(a.edit.name)},a.isVariationSelected=function(){return angular.isDefined(a.edit.selectedVariation)},a.getSegmentCodesStrForVariation=function(a){var b=d.getSegmentTriggerForVariation(a).segments||[],c=b.map(function(a){return a.code}).filter(function(a){
return"undefined"!=typeof a});return c.join(", ")},a.getSegmentLenghtForVariation=function(a){var b=d.getSegmentTriggerForVariation(a).segments||[];return b.length},a.getCriteriaDescrForVariation=function(a){var b=d.getSegmentTriggerForVariation(a);return c("translate")(b.groupBy===h.CRITERIA_AND?"personalization.modal.customizationvariationmanagement.targetgrouptab.allsegments":"personalization.modal.customizationvariationmanagement.targetgrouptab.anysegments")};var j=function(){return{code:a.segmentFilter.code,pageSize:a.segmentPagination.count,currentPage:a.segmentPagination.page+1}},k=function(){a.segmentPagination.count=10,a.segmentPagination.page=-1,a.segmentPagination.totalPages=1},l=function(){a.segmentFilter={code:""},a.edit.segments.length=0};a.segmentPagination={},k(),l(),a.moreSegmentRequestProcessing=!1,a.addMoreSegmentItems=function(){a.segmentPagination.page<a.segmentPagination.totalPages-1&&!a.moreSegmentRequestProcessing&&(a.moreSegmentRequestProcessing=!0,e.getSegments(j()).then(function(b){Array.prototype.push.apply(a.edit.segments,b.segments),a.segmentPagination=b.pagination,a.moreSegmentRequestProcessing=!1},function(b){f.sendError(c("translate")("personalization.error.gettingsegments")),a.moreSegmentRequestProcessing=!1}))},a.segmentSearchInputKeypress=function(b,c){k(),a.segmentFilter.code=c,a.edit.segments.length=0,a.addMoreSegmentItems()},a.segmentSelectedEvent=function(b,c){var d=a.edit.selectedSegments.map(function(a){return a.code}),e=d.some(function(a,b){return d.indexOf(a)!=b});if(e){var f=a.edit.selectedSegments.filter(function(a){return a.code==b.code});a.edit.selectedSegments.splice(a.edit.selectedSegments.indexOf(f[1]),1)}c.search="",a.segmentSearchInputKeypress(null,"")},a.initUiSelect=function(b){b.open&&a.segmentSearchInputKeypress(null,b.search)},a.$watch("edit.selectedSegments",function(){0===(a.edit.selectedSegments||[]).length&&a.segmentSearchInputKeypress(null,"")},!0)}]).directive("uisOpenClose",["$parse","$timeout",function(a,b){return{restrict:"A",require:"uiSelect",link:function(c,d,e,f){f.onOpenCloseCallback=a(e.uisOpenClose),c.$watch("$select.open",function(a,d){a!==d&&b(function(){f.onOpenCloseCallback(c,{isOpen:a})})})}}}]),jQuery(document).ready(function(a){var b=function(b){var c=a("<link rel='stylesheet' type='text/css' href='"+b+"'>");a("head").append(c)};b("/personalizationsmartedit/css/style.css")}),angular.module("personalizationsmarteditcontainermodule",["personalizationsmarteditcontainerTemplates","personalizationsmarteditContextServiceModule","personalizationsmarteditRestServiceModule","ui.bootstrap","personalizationsmarteditCommons","functionsModule","personalizationsmarteditPreviewServiceModule","personalizationsmarteditManagerModule","personalizationsmarteditManagerViewModule","personalizationsmarteditContextMenu","featureServiceModule","perspectiveServiceModule","iFrameManagerModule"]).factory("personalizationsmarteditIFrameUtils",["iFrameManager",function(a){var b={};return b.reloadPreview=function(b,c){a.loadPreview(b,c)},b}]).controller("topToolbarMenuController",["$scope","personalizationsmarteditManager","personalizationsmarteditManagerView",function(a,b,c){a.status={isopen:!1},a.preventDefault=function(a){a.stopPropagation()},a.createCustomizationClick=function(){b.openCreateCustomizationModal()},a.managerViewClick=function(){c.openManagerAction()}}]).run(["$log","$filter","personalizationsmarteditContextService","personalizationsmarteditContextServiceReverseProxy","personalizationsmarteditManagerView","personalizationsmarteditContextModal","featureService","perspectiveService","personalizationsmarteditPreviewService","personalizationsmarteditIFrameUtils","personalizationsmarteditMessageHandler",function(a,b,c,d,e,f,g,h,i,j,k){new d("PersonalizationCtxReverseGateway");g.addToolbarItem({toolbarId:"experienceSelectorToolbar",key:"personalizationsmartedit.container.right.toolbar",type:"HYBRID_ACTION",nameI18nKey:"personalization.right.toolbar",priority:4,section:"left",include:"web/features/personalizationsmarteditcontainer/rightToolbar/personalizationsmarteditRightToolbarItemWrapperTemplate.html"}),g.addToolbarItem({toolbarId:"experienceSelectorToolbar",key:"personalizationsmartedit.container.manager.toolbar",type:"HYBRID_ACTION",nameI18nKey:"personalization.manager.toolbar",priority:5,section:"left",include:"web/features/personalizationsmarteditcontainer/management/personalizationsmarteditCustomizationManagMenuTemplate.html"}),g.register({key:"personalizationsmartedit.context.service",nameI18nKey:"personalization.context.service.name",descriptionI18nKey:"personalization.context.service.description",enablingCallback:function(){c.setPersonalizationContextEnabled(!0)},disablingCallback:function(){var a=c.selectedVariations;if(angular.isObject(a)&&!angular.isArray(a)){var d=c.getSePreviewData().previewTicketId;i.removePersonalizationDataFromPreview(d).then(function(){var a=c.getSePreviewData();j.reloadPreview(a.resourcePath,a.previewTicketId)},function(){k.sendError(b("translate")("personalization.error.updatingpreviewticket"))})}c.setPersonalizationContextEnabled(!1),c.selectedCustomizations=null,c.selectedVariations=null,c.selectedComponents=null}}),h.register({key:"personalizationsmartedit.perspective",nameI18nKey:"personalization.perspective.name",descriptionI18nKey:"personalization.perspective.description",features:["personalizationsmartedit.context.service","personalizationsmartedit.container.right.toolbar","personalizationsmartedit.container.manager.toolbar","personalizationsmarteditComponentLightUp","personalizationsmartedit.context.add.action","personalizationsmartedit.context.edit.action","personalizationsmartedit.context.delete.action","personalizationsmartedit.context.info.action","se.contextualMenu","se.cms.edit"],perspectives:[]})}]),angular.module("personalizationsmarteditcontainermodule").directive("personalizationsmarteditRightToolbarItem",function(){return{templateUrl:"web/features/personalizationsmarteditcontainer/rightToolbar/personalizationsmarteditRightToolbarItemTemplate.html",restrict:"E",transclude:!0,link:function(a,b,c){}}}).controller("personalizationsmarteditRightToolbarController",["$scope","$filter","$timeout","personalizationsmarteditRestService","personalizationsmarteditContextService","personalizationsmarteditMessageHandler","personalizationsmarteditPreviewService","personalizationsmarteditUtils","personalizationsmarteditIFrameUtils","personalizationsmarteditManager",function(a,b,c,d,e,f,g,h,i,j){a.hidePersonalizationButtonI18nKey="personalization.right.toolbar",a.customizationButtonI18nKey="personalization.right.toolbar.customization.button",a.customizationsOnPage=[],a.allCustomizationsCount=void 0,a.search={pageId:e.getPageId(),libraryCustomizations:[],selectedLibraryCustomizations:[],searchCustomizationEnabled:!1},a.pagination={fixedPageSize:!0,currentSize:5};var k=function(a,b){var c=a.filter(function(a){return b.map(function(a){return a.code}).indexOf(a.code)<0});return c},l=function(c){d.getCustomizations(c).then(function(b){angular.isUndefined(a.allCustomizationsCount)&&(a.allCustomizationsCount=b.pagination.totalCount),a.customizationsOnPage=b.customizations||[],a.pagination.currentPage=b.pagination.page,a.pagination.pages=Array(b.pagination.totalPages).join().split(",").map(function(a,b){return b}),a.search.libraryCustomizations.length=0,q(a.libraryCustPagination),a.addMoreCustomizationItems()},function(){f.sendError(b("translate")("personalization.error.gettingcustomizations"))})},m=function(a,c){d.getComponenentsIdsForVariation(a,c).then(function(a){e.setSelectedComponents(a.components)},function(){f.sendError(b("translate")("personalization.error.gettingcomponentsforvariation"))})},n=function(a,c){var d=e.getSePreviewData().previewTicketId,j=h.getVariationKey(a,c);g.updatePreviewTicketWithVariations(d,j).then(function(){var a=e.getSePreviewData();i.reloadPreview(a.resourcePath,a.previewTicketId)},function(){f.sendError(b("translate")("personalization.error.updatingpreviewticket"))})},o=function(){return{pageId:e.getPageId(),currentSize:a.pagination.currentSize,currentPage:a.pagination.currentPage}},p=function(){return{pageId:e.getPageId(),negatePageId:!0,name:a.customizationFilter.name,currentSize:a.libraryCustPagination.count,currentPage:a.libraryCustPagination.page+1}},q=function(a){a.count=10,a.page=-1,a.totalPages=1};a.customizationFilter={name:""},a.libraryCustPagination={},q(a.libraryCustPagination),a.moreCustomizationsRequestProcessing=!1,a.addMoreCustomizationItems=function(){a.libraryCustPagination.page<a.libraryCustPagination.totalPages-1&&!a.moreCustomizationsRequestProcessing&&(a.moreCustomizationsRequestProcessing=!0,d.getCustomizations(p()).then(function(b){var c=k(b.customizations,a.customizationsOnPage);c.forEach(function(a){a.fromLibrary=!0}),Array.prototype.push.apply(a.search.libraryCustomizations,c),a.libraryCustPagination=b.pagination,a.moreCustomizationsRequestProcessing=!1},function(c){f.sendError(b("translate")("personalization.error.gettingcustomizations")),a.moreCustomizationsRequestProcessing=!1}))},a.customizationSearchInputKeypress=function(b,c){q(a.libraryCustPagination),a.customizationFilter.name=c,a.search.libraryCustomizations.length=0,a.addMoreCustomizationItems()};var r=function(){c(function(){l(o())},0)};a.variationClick=function(a,b){e.setSelectedVariations(b),m(a.code,b.code),n(a.code,[b])},a.customizationClick=function(b){var c=e.selectedVariations;if(e.setSelectedCustomizations(b),e.setSelectedVariations(b.variations||null),b.variations.length>0){var d=h.getVariationCodes(b.variations).join(",");m(b.code,d)}angular.isObject(c)&&!angular.isArray(c)&&n(),a.customizationsOnPage.filter(function(a){return b.name!==a.name}).forEach(function(a,b){a.collapsed=!0})},a.addCustomizationFromLibrary=function(){a.customizationsOnPage=a.customizationsOnPage.concat(a.search.selectedLibraryCustomizations),a.search.libraryCustomizations=k(a.search.libraryCustomizations,a.search.selectedLibraryCustomizations),a.search.selectedLibraryCustomizations=[],a.toggleAddMoreCustomizationsClick()},a.toggleAddMoreCustomizationsClick=function(){a.search.searchCustomizationEnabled=!a.search.searchCustomizationEnabled},a.editCustomizationAction=function(a){j.openEditCustomizationModal(a.code)},a.customizationClickAction=function(a){d.getVariationsForCustomization(a.code).then(function(b){a.variations=b.variations},function(){f.sendError(b("translate")("personalization.error.gettingcustomization"))})},a.paginationCallback=function(){r()},a.initCustomization=function(a){a.collapsed=!0,(e.selectedCustomizations||{}).code===a.code&&(a.collapsed=!1)},a.getSelectedVariationClass=function(a){return angular.equals(a,e.selectedVariations)?"selectedVariation":void 0},r()}]),angular.module("personalizationsmarteditContextServiceModule",["sharedDataServiceModule","loadConfigModule"]).factory("personalizationsmarteditContextService",["personalizationsmarteditContextServiceProxy","sharedDataService","loadConfigManagerService",function(a,b,c){var d=new a("PersonalizationCtxGateway"),e={};return e.personalizationEnabled=!1,e.selectedCustomizations=null,e.selectedVariations=null,e.selectedComponents=null,e.seExperienceData=null,e.seConfigurationData=null,e.sePreviewData=null,e.pageId=null,e.isPersonalizationContextEnabled=function(){return e.personalizationEnabled},e.setPersonalizationContextEnabled=function(a){e.personalizationEnabled=a,d.setPersonalizationContextEnabled(a)},e.setSelectedComponents=function(a){e.selectedComponents=a,d.setSelectedComponents(a)},e.setSelectedVariations=function(a){e.selectedVariations=a,d.setSelectedVariations(a)},e.setSelectedCustomizations=function(a){e.selectedCustomizations=a,d.setSelectedCustomizations(a)},e.refreshExperienceData=function(){b.get("experience").then(function(a){e.setSeExperienceData(a)})},e.getSeExperienceData=function(){return e.seExperienceData},e.setSeExperienceData=function(a){e.seExperienceData=a,d.setSeExperienceData(a)},e.getSePreviewData=function(){return e.sePreviewData},e.setSePreviewData=function(a){e.sePreviewData=a,d.setSePreviewData(a)},e.refreshPreviewData=function(){b.get("preview").then(function(a){e.setSePreviewData(a)})},e.refreshConfigurationData=function(){c.loadAsObject().then(function(a){e.setSeConfigurationData(a)})},e.getSeConfigurationData=function(){return e.seConfigurationData},e.setSeConfigurationData=function(a){e.seConfigurationData=a,d.setSeConfigurationData(a)},e.getPageId=function(){return e.pageId},e.setPageId=function(a){e.pageId=a},e.applySynchronization=function(){d.setSelectedVariations(e.selectedVariations),d.setSelectedCustomizations(e.selectedCustomizations),d.setSelectedComponents(e.selectedComponents),d.setPersonalizationContextEnabled(e.personalizationEnabled),e.refreshExperienceData(),e.refreshPreviewData(),e.refreshConfigurationData()},e.getContexServiceProxy=function(){return d},e}]).factory("personalizationsmarteditContextServiceProxy",["gatewayProxy",function(a){var b=function(b){this.gatewayId=b,a.initForService(this)};return b.prototype.setPersonalizationContextEnabled=function(){},b.prototype.setSelectedComponents=function(){},b.prototype.setSelectedVariations=function(){},b.prototype.setSelectedCustomizations=function(){},b.prototype.setSeExperienceData=function(){},b.prototype.setSeConfigurationData=function(){},b.prototype.setSePreviewData=function(){},b}]).factory("personalizationsmarteditContextServiceReverseProxy",["gatewayProxy","personalizationsmarteditContextService",function(a,b){var c=function(b){this.gatewayId=b,a.initForService(this)};return c.prototype.applySynchronization=function(){b.applySynchronization()},c.prototype.setPageId=function(a){b.setPageId(a)},c}]),angular.module("personalizationsmarteditPreviewServiceModule",["personalizationsmarteditRestServiceModule","sharedDataServiceModule","personalizationsmarteditCommons","personalizationsmarteditContextServiceModule"]).factory("personalizationsmarteditPreviewService",["$q","$filter","personalizationsmarteditRestService","sharedDataService","personalizationsmarteditUtils","personalizationsmarteditMessageHandler","personalizationsmarteditContextService",function(a,b,c,d,e,f,g){var h={};return h.removePersonalizationDataFromPreview=function(b){var c=a.defer();return h.updatePreviewTicketWithVariations(b,[]).then(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise},h.updatePreviewTicketWithVariations=function(d,e){var g=a.defer();return c.getPreviewTicket(d).then(function(a){a.variations=e,g.resolve(c.updatePreviewTicket(a))},function(a){404===a.status?g.resolve(h.createPreviewTicket(e)):(f.sendError(b("translate")("personalization.error.gettingpreviewticket")),g.reject(a))}),g.promise},h.createPreviewTicket=function(d){var e=g.getSeExperienceData(),i=g.getSeConfigurationData(),j=a.defer(),k=i.domain+e.siteDescriptor.previewUrl,l={catalog:e.catalogDescriptor.catalogId,catalogVersion:e.catalogDescriptor.catalogVersion,language:e.languageDescriptor.isocode,resourcePath:k,variations:d};return c.createPreviewTicket(l).then(function(a){h.storePreviewTicketData(a.resourcePath,a.ticketId),g.refreshPreviewData(),f.sendInformation(b("translate")("personalization.info.newpreviewticketcreated")),j.resolve(a)},function(a){f.sendError(b("translate")("personalization.error.creatingpreviewticket")),j.reject(a)}),j.promise},h.storePreviewTicketData=function(a,b){var c={previewTicketId:b,resourcePath:a};d.set("preview",c)},h}]),angular.module("personalizationsmarteditRestServiceModule",["restServiceFactoryModule","personalizationsmarteditCommons","personalizationsmarteditContextServiceModule"]).factory("personalizationsmarteditRestService",["restServiceFactory","personalizationsmarteditUtils","personalizationsmarteditContextService",function(a,b,c){var d="/personalizationwebservices/v1/catalogs/:catalogId/catalogVersions/:catalogVersion/customizations",e=d+"/:customizationCode",f="/personalizationwebservices/v1/catalogs/:catalogId/catalogVersions/:catalogVersion/customizationpackages",g=f+"/:customizationCode",h=e+"/variations",i=h+"/:variationCode",j=i+"/actions",k=j+"/:actionId",l="/personalizationwebservices/v1/query/cxcmscomponentsfromvariations",m="/previewwebservices/v1/preview/:ticketId",n="/personalizationwebservices/v1/segments",o="/cmswebservices/v1/sites/:siteId/catalogs/:catalogId/versions/:catalogVersion/items",p=o+"/:itemId",q="/personalizationwebservices/v1/query/cxReplaceComponentWithContainer",r="/cmswebservices/v1/types?category=COMPONENT",s=["active","enabled","code","name","rank"],t="triggers(code,groupBy,segments)",u="actions",v=function(a){var b=c.getSeExperienceData(),d={catalogId:b.catalogDescriptor.catalogId,catalogVersion:b.catalogDescriptor.catalogVersion};return a=angular.extend(a,d)},w=function(a,b){var c={customizationCode:b};return a=angular.extend(a,c)},x=function(a,c,d,e,f,g){var h=[];return b.pushToArrayIfValueExists(h,"oldComponentId",a),b.pushToArrayIfValueExists(h,"newComponentId",c),b.pushToArrayIfValueExists(h,"slotId",d),b.pushToArrayIfValueExists(h,"containerId",e),b.pushToArrayIfValueExists(h,"variationId",g),b.pushToArrayIfValueExists(h,"customizationId",f),{params:{entry:h}}},y=function(a,b,d){var e=c.getSeExperienceData();return{customizationCode:a,variationCode:b,actionId:d,catalogId:e.catalogDescriptor.catalogId,catalogVersion:e.catalogDescriptor.catalogVersion}},z={};return z.getCustomizations=function(b){b=b||{};var c=a.get(d),e={};return e=v(e),e=w(e),e.pageSize=b.currentSize||10,e.currentPage=b.currentPage||0,angular.isDefined(b.code)&&(e.code=b.code||""),angular.isDefined(b.pageId)&&(e.pageId=b.pageId||""),angular.isDefined(b.name)&&(e.name=b.name||""),angular.isDefined(b.negatePageId)&&(e.negatePageId=b.negatePageId||"false"),c.get(e)},z.getComponenentsIdsForVariation=function(d,e){var f=c.getSeExperienceData(),g=a.get(l),h=[];b.pushToArrayIfValueExists(h,"customization",d),b.pushToArrayIfValueExists(h,"variations",e),b.pushToArrayIfValueExists(h,"catalog",f.catalogDescriptor.catalogId),b.pushToArrayIfValueExists(h,"catalogVersion",f.catalogDescriptor.catalogVersion);var i={params:{entry:h}};return g.save(i)},z.getPreviewTicket=function(){var b=c.getSePreviewData(),d=a.get(m,"ticketId"),e={ticketId:b.previewTicketId};return d.get(e)},z.updatePreviewTicket=function(b){var c=a.get(m,"ticketId");return c.update(b)},z.createPreviewTicket=function(b){var c=a.get(m);return c.save(b)},z.getSegments=function(b){var c=a.get(n);return c.get(b)},z.getCustomization=function(b){var c=a.get(e,"customizationCode"),d={customizationCode:b};return c.get(v(d))},z.createCustomization=function(b){var c=a.get(f);return c.save(v(b))},z.updateCustomization=function(b){var c=a.get(e,"customizationCode");return b.customizationCode=b.code,c.update(v(b))},z.updateCustomizationPackage=function(b){var c=a.get(g,"customizationCode");return b.customizationCode=b.code,c.update(v(b))},z.deleteCustomization=function(b){var c=a.get(e,"customizationCode"),d={customizationCode:b};return c.remove(v(d))},z.getVariation=function(b,c){var d=a.get(i,"variationCode"),e={variationCode:c};return e=v(e),e=w(e,b),d.get(e)},z.editVariation=function(b,c){var d=a.get(i,"variationCode");return c=v(c),c=w(c,b),c.variationCode=c.code,d.update(c)},z.deleteVariation=function(b,c){var d=a.get(i,"variationCode"),e={variationCode:c};return e=v(e),e=w(e,b),d.remove(e)},z.createVariationForCustomization=function(b,c){var d=a.get(h);return c=v(c),c=w(c,b),d.save(c)},z.getVariationsForCustomization=function(b,c){var d=a.get(h),e={},f=[];return e=v(e),e=w(e,b),f=f.concat(s),c.includeActions&&f.push(u),c.includeTriggers&&f.push(t),e.fields="variations("+f.join()+")",d.get(e)},z.getComponents=function(b){var d=c.getSeExperienceData(),e=a.get(o),f={catalogId:d.catalogDescriptor.catalogId,catalogVersion:d.catalogDescriptor.catalogVersion,siteId:d.siteDescriptor.uid};return f=angular.extend(f,b),e.get(f)},z.replaceComponentWithContainer=function(c,d){var e=a.get(q),f=v({}),g=x(c,null,d,null,null,null);return b.pushToArrayIfValueExists(g.params.entry,"catalog",f.catalogId),b.pushToArrayIfValueExists(g.params.entry,"catalogVersion",f.catalogVersion),e.save(g)},z.addActionToContainer=function(b,c,d,e){var f=a.get(j),g=y(d,e),h={type:"cxCmsActionData",containerId:c,componentId:b};return h=angular.extend(h,g),f.save(h)},z.editAction=function(b,c,d,e){var f=a.get(k,"actionId"),g=y(b,c,d);return f.get(g).then(function(a){return a=angular.extend(a,g),a.componentId=e,f.update(a)})},z.deleteAction=function(b,c,d){var e=a.get(k,"actionId"),f=y(b,c,d);return e.remove(f)},z.createComponent=function(b,d,e,f){var g=c.getSeExperienceData(),h=a.get(o),i={name:b,slotId:f,pageId:e,position:1,typeCode:d,siteId:g.siteDescriptor.uid};return i=v(i),h.save(i)},z.removeComponent=function(b,d){var e=c.getSeExperienceData(),f=a.get(p,"itemId"),g={slotId:d,itemId:b,siteId:e.siteDescriptor.uid};return g=v(g),f.remove(g)},z.getComponent=function(b){var d=c.getSeExperienceData(),e=a.get(p,"itemId"),f={itemId:b,siteId:d.siteDescriptor.uid};return f=v(f),e.get(f)},z.getNewComponentTypes=function(){var b=a.get(r);return b.get()},z}]),angular.module("personalizationsmarteditcontainerTemplates",[]).run(["$templateCache",function(a){"use strict";a.put("web/features/personalizationsmarteditcontainer/contextMenu/personalizationsmarteditAddEditActionTemplate.html",'<div class="customization-component">\n    <div class="row">\n        <div class="col-md-6">\n            <dl>\n                <dt class="text-uppercase text-smaller dt-text-grey-semibold" data-translate="personalization.modal.addeditaction.selected.customization.title"></dt>\n                <dd class="dd-text-dark-blue-bold">{{selectedCustomization.name}}</dd>\n            </dl>\n        </div>\n        <div class="col-md-6">\n            <dl>\n                <dt class="text-uppercase text-smaller dt-text-grey-semibold" data-translate="personalization.modal.addeditaction.selected.mastercomponent.title"></dt>\n                <dd class="dd-text-dark-blue-bold">{{componentType}}</dd>\n            </dl>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col-md-6">\n            <dl>\n                <dt class="text-uppercase text-smaller dt-text-grey-semibold" data-translate="personalization.modal.addeditaction.selected.variation.title"></dt>\n                <dd class="dd-text-dark-blue-bold">{{selectedVariation.name}}</dd>\n            </dl>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col-md-6">\n            <dl>\n                <dt class="text-uppercase dt-text-grey-semibold" data-translate="personalization.modal.addeditaction.selected.actions.title"></dt>\n            </dl>\n        </div>\n    </div>\n\n    <ui-select ng-model="action.selected" theme="select2" title="" search-enabled="false">\n        <ui-select-match placeholder="{{\'personalization.modal.addeditaction.dropdown.placeholder\' | translate}}">\n            <span ng-bind="$select.selected.name | translate"></span>\n        </ui-select-match>\n        <ui-select-choices repeat="item in actions" position="down">\n            <span ng-bind="item.name | translate"></span>\n        </ui-select-choices>\n    </ui-select>\n\n    <ui-select ng-show="action.selected.id == \'use\'" ng-model="component.selected" ng-keyup="componentSearchInputKeypress($event, $select.search)" theme="select2" title="" reset-search-input="false">\n        <ui-select-match placeholder="{{\'personalization.modal.addeditaction.dropdown.componentlist.placeholder\' | translate}}">\n            <span ng-bind="$select.selected.name | translate"></span>\n        </ui-select-match>\n        <ui-select-choices repeat="item in components" position="down" personalization-infinite-scroll="addMoreComponentItems()" personalization-infinite-scroll-distance="2">\n            <div class="row">\n                <span class="col-md-7" ng-bind="item.name | translate"></span>\n                <span class="col-md-5" ng-bind="item.typeCode | translate"></span>\n            </div>\n        </ui-select-choices>\n    </ui-select>\n\n    <ui-select ng-show="action.selected.id == \'create\'" on-select="newComponentTypeSelectedEvent($item, $model)" ng-model="newComponent.selected" theme="select2" title="" search-enabled="false">\n        <ui-select-match placeholder="{{\'personalization.modal.addeditaction.dropdown.componenttype.placeholder\' | translate}}">\n            <span ng-bind="$select.selected.name | translate"></span>\n        </ui-select-match>\n        <ui-select-choices repeat="item in newComponentTypes" position="down">\n            <span ng-bind="item.name | translate"></span>\n        </ui-select-choices>\n    </ui-select>\n</div>'),a.put("web/features/personalizationsmarteditcontainer/management/managerView/personalizationsmarteditManagerViewTemplate.html",'<div id="editConfigurationsBody" class="manage-customization">\n\n    <h2 class="text-capitalize h2-color--grey-font" ng-bind="catalogName"></h2>\n\n    <div class="input-group customization-search">\n        <span class="input-group-addon glyphicon glyphicon-search ySESearchIcon"></span>\n        <input type="text" class="form-control ng-pristine ng-untouched ng-valid" placeholder="{{ \'personalization.manager.modal.search.placeholder\' | translate}}" ng-model="search.name" ng-keyup="searchInputKeypress($event)"></input>\n    </div>\n    <div ng-show="isFilterEnabled()">\n        <div class="search-results">\n            <span ng-bind="filteredCustomizationsCount"></span>\n            <span data-translate="personalization.manager.modal.search.result.label"></span>\n        </div>\n    </div>\n\n    <div class="categoryTable">\n        <!-- headers -->\n        <div class="row row-reset-margin tablehead hidden-xs">\n            <div class="col-xs-8 text-left" data-translate="personalization.manager.modal.grid.header.customization"></div>\n            <div class="col-xs-2 text-left" data-translate="personalization.manager.modal.grid.header.variations"></div>\n            <div class="col-xs-2 text-left" data-translate="personalization.manager.modal.grid.header.components"></div>\n        </div>\n\n        <div class="row row-reset-margin">\n            <div class="col-xs-12 col-reset-padding">\n                <button class="y-add y-add-btn button-margin" type="button" data-ng-click="openNewModal();">\n                    <span class="hyicon hyicon-add" data-translate="personalization.manager.modal.add.button"></span>\n                </button>\n            </div>\n        </div>\n\n        <div data-ng-repeat="customization in customizations" ng-init="isCollapsed=true">\n            <div class="row row-reset-margin customizationLayout divider">\n                <div class="col-xs-half text-right" ng-click="isCollapsed=! isCollapsed; customizationClickAction(customization)">\n                    <a class="btn btn-link category-toggle">\n                        <span class="glyphicon glyphicon-chevron-down "></span>\n                    </a>\n                </div>\n                <div class="col-xs-8 pull-left text-left" ng-click="isCollapsed=! isCollapsed; customizationClickAction(customization)">\n                    <p class="primaryData customization-rank-{{customization.rank}}-row ">\n                        <span class="categoryName personalizationsmartedit-customization-code ">{{customization.name}}</span>\n                    </p>\n                </div>\n                <div class="col-xs-2 pull-left text-left">\n                    <p>{{customization.variations.length || 0}}</p>\n                </div>\n                <div class="col-xs-half col-offset-1 pull-right">\n                    <button type="button" class="btn btn-link dropdown-toggle pull-right" data-toggle="dropdown">\n                        <span class="hyicon hyicon-more"></span>\n                    </button>\n                    <ul class="dropdown-menu pull-right text-left" role="menu">\n                        <li>\n                            <a class="customization-edit-button" ng-click="editCustomizationAction(customization)" data-translate="personalization.manager.modal.button.edit"></a>\n                        </li>\n                        <li>\n                            <a class="customization-delete-button" ng-click="deleteCustomizationAction(customization)" data-translate="personalization.manager.modal.button.delete"></a>\n                        </li>\n                        <li ng-class="isFilterEnabled() || $first ? \'disabled\' : \'\' ">\n                            <a class="customization-move-up-button" ng-click="setCustomizationRank(customization, -1, $event, $first)" data-translate="personalization.manager.modal.button.moveup"></a>\n                        </li>\n                        <li ng-class="isFilterEnabled() || $last ? \'disabled\' : \'\' ">\n                            <a class="customization-move-down-button" ng-click="setCustomizationRank(customization, 1, $event, $last)" data-translate="personalization.manager.modal.button.movedown"></a>\n                        </li>\n                    </ul>\n                </div>\n                <!--end col-sm-5 for contextual menu-->\n            </div>\n            <!--end customizationLayout-->\n\n            <div collapse="isCollapsed">\n                <div ng-repeat="variation in customization.variations">\n                    <div class="variationLayout divider">\n                        <div class="row row-reset-margin variation-rank-{{variation.rank}}-row">\n                            <div class="col-xs-half"></div>\n                            <div class="col-xs-10 text-left">\n                                <span>{{variation.name}}</span>\n                            </div>\n                            <div class="col-xs-1 text-left ">\n                                <span>{{variation.numberOfComponents}}</span>\n                            </div>\n                            <div class="col-xs-half pull-right">\n                                <button type="button" class="btn btn-link dropdown-toggle pull-right" data-toggle="dropdown">\n                                    <span class="hyicon hyicon-more"></span>\n                                </button>\n                                <ul class="dropdown-menu text-left pull-right" role="menu">\n                                    <li>\n                                        <a class="customization-edit-button" ng-click="editVariationAction(customization, variation)" data-translate="personalization.manager.modal.button.edit"></a>\n                                    </li>\n                                    <li ng-class="customization.variations.length < 2 ? \'disabled\' : \'\' ">\n                                        <a class="customization-delete-button" ng-click="deleteVariationAction(customization, variation, $event)" data-translate="personalization.manager.modal.button.delete"></a>\n                                    </li>\n                                    <li ng-class="$first ? \'disabled\' : \'\' ">\n                                        <a class="variation-move-down-button" ng-click="setVariationRank(customization, variation, -1, $event, $first)" data-translate="personalization.manager.modal.button.moveup"></a>\n                                    </li>\n                                    <li ng-class="$last ? \'disabled\' : \'\' ">\n                                        <a class="variation-move-down-button" ng-click="setVariationRank(customization, variation, 1, $event, $last)" data-translate="personalization.manager.modal.button.movedown"></a>\n                                    </li>\n                                </ul>\n                            </div>\n                            <!--end col-sm-2 for contextual menu-->\n                        </div>\n                        <!--end variation-rank-->\n                    </div>\n                    <!--end variationLayout-->\n                </div>\n                <!--end variation-repeat-->\n            </div>\n            <!--end collapse-->\n        </div>\n        <!--end customization-repeat-->\n    </div>\n    <!--end categoryTable-->\n    <personalizationsmartedit-pagination pages="pagination.pages " current-page="pagination.currentPage " page-sizes="pagination.pageSizes " current-size="pagination.currentSize " pages-offset="pagination.pagesOffset " callback="paginationCallback " />\n</div>'),
a.put("web/features/personalizationsmarteditcontainer/management/personalizationsmarteditCustomizationManagMenuTemplate.html",'<div ng-controller="topToolbarMenuController" dropdown is-open="status.isopen" auto-close="disabled" class="ySEComponentMenuW">\n    <button type="button" class="btn btn-default yHybridAction ySEComponentMenuW--button personalizationsmarteditTopToolbarButton" dropdown-toggle ng-disabled="disabled" aria-pressed="false">\n        <img data-ng-src="../personalizationsmartedit/icons/icon_library.png" />\n        <span class="ySEComponentMenuW--button--txt" data-translate="personalization.manager.toolbar"></span>\n    </button>\n    <ul ng-if="status.isopen" class="dropdown-menu btn-block ySEComponentMenu ySEComponentMenu-customized" role="menu" ng-click="preventDefault($event);">\n        <div class="ySEComponentMenu-headers">\n            <h2 class="text-uppercase h2" data-translate="personalization.right.toolbar.library.name"></h2>\n            <small class="small" data-translate="personalization.topmenu.library.info"></small>\n        </div>\n        <li class="divider divider-lefttoolbar">\n        </li>\n        <li class="item ySEComponentMenuList--item">\n            <a class="ySEComponentMenu-anchor" id="personalizationsmartedit-right-toolbar-customization-anchor" data-translate="personalization.topmenu.library.manager.name" data-ng-click="managerViewClick()"></a>\n        </li>\n        <li class="divider divider-lefttoolbar"></li>\n        <li class="item ySEComponentMenuList--item">\n            <a class="ySEComponentMenu-anchor" id="personalizationsmartedit-right-toolbar-customization-anchor" data-translate="personalization.manager.modal.add.button" data-ng-click="createCustomizationClick()"></a>\n        </li>\n    </ul>\n</div>'),a.put("web/features/personalizationsmarteditcontainer/management/personalizationsmarteditCustomizationManagTemplate.html",'<div>\n    <tabset>\n        <tab ng-repeat="tab in tabsArr" select="selectTab(tab)" active="tab.active" disable="tab.disabled" heading="{{tab.heading}}">\n            <form name="{{tab.formName}}" novalidate>\n                <div>\n                    <ng-include src="tab.template"></ng-include>\n                </div>\n            </form>\n        </tab>\n    </tabset>\n</div>'),a.put("web/features/personalizationsmarteditcontainer/management/tabs/personalizationsmarteditCustVarManagBasicInfoTemplate.html",'<div class="customization-form--size-large">\n    <div class="form-group">\n        <label data-translate="personalization.modal.customizationvariationmanagement.basicinformationtab.name" class="customization-form-control-label--size"></label>\n        <input type="text" class="form-control customization-form-control-input--size" placeholder="{{\'personalization.modal.customizationvariationmanagement.basicinformationtab.name.placeholder\' | translate}}" name="{{customization.name}}_key" data-ng-model="customization.name" data-ng-required="true">\n    </div>\n    <div class="form-group">\n        <label data-translate="personalization.modal.customizationvariationmanagement.basicinformationtab.details" class="customization-form-control-label--size"></label>\n        <textarea rows="8" class="form-control customization-form-control-input--size" placeholder="{{\'personalization.modal.customizationvariationmanagement.basicinformationtab.details.placeholder\' | translate}}" name="{{customization.description}}_key" data-ng-model="customization.description"></textarea>\n    </div>\n</div>'),a.put("web/features/personalizationsmarteditcontainer/management/tabs/personalizationsmarteditCustVarManagTargetGrpTemplate.html",'<div ng-controller="personalizationsmarteditManagerTargetGrpController" class="row customization-form--size-large">\n    <div class="customization-form-target-group-tab-sub-title--size--font">\n        <span ng-bind="customization.name"></span>\n        <span ng-if=\'customization.description\'>:</span>\n        <span class="customization-form-target-group-tab-sub-title-description--font"></span>\n        <span ng-bind="customization.description"></span>\n    </div>\n    <div class="col-md-6">\n        <div ng-if=\'customization.variations.length === 0\'>\n            <label class="customization-form-control-label--size" data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab"></label>\n            <h6 data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.notargetgroups"></h6>\n        </div>\n\n        <div ng-if=\'customization.variations.length > 0\'>\n            <label class="customization-form-control-label--size" data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab"></label>\n\n            <ul class="list-group">\n                <li class="list-group-item list-group-item-size list-group-item--hover" data-ng-repeat="variation in customization.variations ">\n\n                    <div class="row target-group-list">\n                        <div class="col-md-11">\n                            <div class="customization-variation-code-font-text-style" ng-bind="variation.name"></div>\n                            <div ng-bind="getSegmentCodesStrForVariation(variation)"></div>\n                            <div ng-if="getSegmentLenghtForVariation(variation) > 1">\n                                </br>\n                                <span class="customization-criteria-font-size" data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.criteria.colon"></span>\n                                <span ng-bind="getCriteriaDescrForVariation(variation)"></span>\n                                </br>\n                            </div>\n                        </div>\n\n                        <div class="col-md-1">\n                            <button type="button" class="dropdown pull-right btn btn-link dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">\n                                <span class="hyicon hyicon-more hyicon-in-modal-size"></span>\n                            </button>\n                            <ul class="dropdown-menu" aria-labelledby="dropdownMenu1" role="menu">\n                                <li>\n                                    <a ng-click="editVariationAction(variation)" data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.action.edit" />\n                                </li>\n\n                                <li>\n                                    <a ng-click="removeVariationClick(variation)" data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.action.remove" />\n                                </li>\n\n                                <li ng-class="$first ? \'disabled\' : \'\' ">\n                                    <a ng-click="setVariationRank(variation, -1, $event, $first)" data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.action.moveup" />\n                                </li>\n\n                                <li ng-class="$last ? \'disabled\' : \'\' ">\n                                    <a ng-click="setVariationRank(variation, 1, $event, $last)" data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.action.movedown" />\n                                </li>\n                            </ul>\n\n                        </div>\n\n                    </div>\n\n                </li>\n            </ul>\n\n        </div>\n    </div>\n    <div class="col-md-6">\n\n        <div class="form-group">\n            <label class="customization-form-control-label--size" data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.targetgroupname"></label>\n            <input uniquetargetgroupname type="text" class="form-control" placeholder="{{\'personalization.modal.customizationvariationmanagement.targetgrouptab.targetgroupname.placeholder\' | translate}}" name="variationname_key" data-ng-model="edit.name">\n            <span ng-show="{{tab.formName}}.variationname_key.$error.uniquetargetgroupname" data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.targetgroup.uniquename.validation.message"></span>\n        </div>\n\n        <div class="form-group">\n            <label class="customization-form-control-label--size" data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.segments"></label>\n            <ui-select uis-open-close="initUiSelect($select)" multiple=\'true\' ng-model="edit.selectedSegments" theme="select2personalization" ng-disabled="disabled" class="form-control" ng-keyup="segmentSearchInputKeypress($event, $select.search)" on-select="segmentSelectedEvent($item, $select)" on-remove="segmentSelectedEvent($item, $select)">\n                <ui-select-match placeholder="{{ \'personalization.modal.customizationvariationmanagement.targetgrouptab.segments.placeholder\' | translate}}">\n                    <span class="customization-ui-select-match-item--colors">{{$item.code}} &lt;{{$item.code}}&gt;</span>\n                    <span class="close ui-select-match-close" ng-hide="$select.disabled" ng-click="$selectMultiple.removeChoice($index)">&nbsp;×</span>\n                </ui-select-match>\n                <ui-select-choices repeat="item in edit.segments" position="down" personalization-infinite-scroll="addMoreSegmentItems()" personalization-infinite-scroll-distance="2">\n                    <div ng-html-bind="item.code"></div>\n                    <small>\n                        Segment: {{item.code}}\n                    </small>\n                </ui-select-choices>\n            </ui-select>\n        </div>\n\n        <div class="form-group" ng-if="canShowVariationSegmentationCriteria()">\n            <label class="customization-form-control-label--size" data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.criteria"></label>\n            <div class="row">\n                <div class="col-md-6">\n                    <input type="checkbox" data-ng-model="edit.allSegmentsChecked">\n                    <label data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.allsegments" ng-click="edit.allSegmentsChecked = !edit.allSegmentsChecked"></label>\n                </div>\n                <div class="col-md-6">\n                    <input type="checkbox" negate data-ng-model="edit.allSegmentsChecked">\n                    <label data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.anysegments" ng-click="edit.allSegmentsChecked = !edit.allSegmentsChecked"></label>\n                </div>\n            </div>\n        </div>\n\n        <div ng-if="!isVariationSelected()">\n            <button type="button" class="btn btn-default add-target-group" data-ng-click="addVariationClick()" data-ng-disabled="!canSaveVariation()" data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.addvariation"></button>\n        </div>\n        <div ng-if="isVariationSelected()">\n            <button type="button" class="btn btn-default submit-target-group-edit" data-ng-click="submitChangesClick()" data-ng-disabled="!canSaveVariation()" data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.savechanges"></button>\n            <button type="button" class="btn btn-subordinate cancel-target-group-edit" data-ng-click="cancelChangesClick()" data-translate="personalization.modal.customizationvariationmanagement.targetgrouptab.cancelchanges"></button>\n        </div>\n    </div>\n</div>'),a.put("web/features/personalizationsmarteditcontainer/rightToolbar/personalizationsmarteditRightToolbarItemTemplate.html",'<div id="personalizationsmartedit-right-toolbar-item-template" class="manage-customization">\n\n    <div ng-controller="personalizationsmarteditRightToolbarController" data-customizations-loaded="{{customizationsOnPage.length > 0}}">\n\n        <div class="reset-padding" ng-show="!search.searchCustomizationEnabled">\n            <button class="y-add y-add-btn y-add-btn-lefttoolbar" type="button" data-ng-click="toggleAddMoreCustomizationsClick()">\n                <span class="hyicon hyicon-add" data-translate="personalization.right.toolbar.addmorecustomizations.button" />\n            </button>\n        </div>\n        <div class="text-left search-item-lefttoolbar" ng-show="search.searchCustomizationEnabled">\n            <ui-select multiple class="form-control customizations-from-library-multi-select" ng-model="search.selectedLibraryCustomizations" theme="select2" ng-disabled="disabled" on-select="addCustomizationFromLibrary()" ng-keyup="customizationSearchInputKeypress($event, $select.search)">\n                <ui-select-match placeholder="{{\'personalization.right.toolbar.addmorecustomizations.customization.library.search.placeholder\' | translate}}">\n                    {{$item.name}} &lt;{{$item.name}}&gt;\n                </ui-select-match>\n                <ui-select-choices repeat="item in search.libraryCustomizations" personalization-infinite-scroll="addMoreCustomizationItems()" personalization-infinite-scroll-distance="2">\n                    <div ng-html-bind="item.name | highlight: $select.search"></div>\n                    <small>{{item.name}}</small>\n                </ui-select-choices>\n            </ui-select>\n        </div>\n\n        <div class="overflow-wrapper-lefttoolbar">\n            <div class="categoryTable categoryTable-lefttoolbar">\n                <div data-ng-repeat="customization in customizationsOnPage | orderBy: \'rank\'" ng-init="initCustomization(customization)">\n                    <div class="row row-lefttoolbar">\n                        <div ng-class="{\'custFromLibExtraStyling customization-from-library\':customization.fromLibrary, \'customization-rank-{{customization.rank}}\':true}">\n                            <div class="col-xs-1 text-right" ng-click="customization.collapsed = !customization.collapsed; customizationClick(customization)">\n                                <a class="btn btn-link category-toggle">\n                                    <span class="glyphicon glyphicon-chevron-down glyphicon-down-lefttoolbar"></span>\n                                </a>\n                            </div>\n                            <div class="col-xs-9 text-left" ng-click="customization.collapsed = !customization.collapsed; customizationClick(customization)">\n                                <span class="primaryData">{{customization.name}}</span>\n                            </div>\n                            <div class="col-xs-1" ng-init="subMenu=false">\n\n                                <button type="button" class="btn btn-link dropdown-toggle pull-right customization-rank-{{customization.rank}}-dropdown-toggle" data-toggle="dropdown" ng-click="subMenu = !subMenu">{{\'personalization.right.toolbar.customization.cust.onpage.action\' | translate}}\n                                    <span class="hyicon hyicon-more"></span>\n                                </button>\n                                <ul ng-if="subMenu" class="dropdown-menu pull-right text-left dropdown-menu-leftoolbar" role="menu">\n                                    <li>\n                                        <a class="dropdown-menu-single-item cutomization-rank-{{customization.rank}}-edit-button" ng-click="editCustomizationAction(customization)" data-translate="personalization.manager.modal.button.edit"></a>\n                                    </li>\n                                </ul>\n\n                            </div>\n                        </div>\n                    </div>\n                    <!--end row desktopLayout-->\n\n                    <div collapse="customization.collapsed">\n                        <div ng-repeat="variation in customization.variations">\n                            <div class="row row-lefttoolbar" ng-class="getSelectedVariationClass(variation)">\n                                <div class="col-xs-9 col-xs-offset-1 text-left" ng-click="variationClick(customization, variation)">\n                                    <span>{{variation.name}}</span>\n                                </div>\n                                <div class="col-xs-1 text-left selectedVariation-icon"></div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <!--end data repeat-->\n            </div>\n            <!--end of categoryTable-->\n\n            <personalizationsmartedit-pagination pages="pagination.pages" current-page="pagination.currentPage" page-sizes="pagination.pageSizes" current-size="pagination.currentSize" pages-offset="pagination.pagesOffset" fixed-page-size="pagination.fixedPageSize" callback="paginationCallback" template="personalizationsmarteditPaginationLefttoolbarTemplate.html" />\n        </div>\n        <!--end of overflow-wrapper-lefttoolbar -->\n    </div>\n</div>'),a.put("web/features/personalizationsmarteditcontainer/rightToolbar/personalizationsmarteditRightToolbarItemWrapperTemplate.html",'<div ng-controller="topToolbarMenuController" dropdown is-open="status.isopen" auto-close="disabled" class="ySEComponentMenuW">\n    <button type="button" class="btn btn-default yHybridAction ySEComponentMenuW--button personalizationsmarteditTopToolbarButton" dropdown-toggle ng-disabled="disabled" aria-pressed="false">\n        <img data-ng-src="../personalizationsmartedit/icons/icon_customize.png" />\n        <span class="ySEComponentMenuW--button--txt" data-translate="personalization.right.toolbar"></span>\n    </button>\n    <ul ng-if="status.isopen" class="dropdown-menu dropdown-menu-left btn-block ySEComponentMenu ySEComponentMenu-customized" role="menu" ng-click="preventDefault($event);">\n        <div class="ySEComponentMenu-headers">\n            <h2 class="text-uppercase h2" data-translate="personalization.right.toolbar.customization.heading"></h2>\n            <small class="small" data-translate="personalization.right.toolbar.customization.description"></small>\n        </div>\n        <li role="menuitem" class="item menuitem-lefttoolbar">\n            <personalizationsmartedit-right-toolbar-item selected-item-callbacks="selectedItemCallbacks" close-page-tool-menu="closePageToolMenu()"></personalizationsmartedit-right-toolbar-item>\n        </li>\n    </ul>\n</div>')}]);