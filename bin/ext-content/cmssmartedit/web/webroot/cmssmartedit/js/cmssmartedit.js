angular.module("cmssmartedit",["resourceLocationsModule","decoratorServiceModule","contextualMenuServiceModule","removeComponentServiceModule","experienceInterceptorModule","editorEnablerServiceModule","alertServiceModule","translationServiceModule","featureServiceModule","slotVisibilityButtonModule","slotVisibilityServiceModule","cmssmarteditTemplates","componentHandlerServiceModule","assetsServiceModule","slotSharedButtonModule"]).run(["$rootScope","$translate","decoratorService","contextualMenuService","alertService","removeComponentService","editorEnablerService","featureService","componentHandlerService","assetsService","slotVisibilityService",function(a,b,c,d,e,f,g,h,i,j,k){var l=function(a,b,c){var d;"function"==typeof window.Event?d=new MouseEvent(b,{bubbles:!0,cancelable:!1,clientX:c.clientX,clientY:c.clientY,offsetX:c.offsetX,offsetY:c.offsetY,pageX:c.pageX,pageY:c.pageY,screenX:c.screenX,screenY:c.screenY,view:c.view}):(d=document.createEvent("MouseEvents"),d.initMouseEvent(b,!0,!1,c.view,0,c.offsetX,c.offsetY,c.clientX,c.clientY,!1,!1,!1,!1,0,null)),a.dispatchEvent(d)};g.enableForComponents(["^.*Component$"]),c.addMappings({"^((?!Slot).)*$":["se.contextualMenu"],"^.*Slot$":["se.slotContextualMenu","se.basicSlotContextualMenu"]}),h.addContextualMenuButton({key:"se.cms.dragandropbutton",nameI18nKey:"contextmenu.title.dragndrop",regexpKeys:["^((?!Slot).)*$"],condition:function(a,b){return!0},callback:function(){},callbacks:{mousedown:function(a,b){var c=i.getOriginalComponentWithinSlot(a.componentId,a.componentType,a.slotId).get(0);l(c,"mousedown",b)}},displayClass:"movebutton",iconIdle:j.getAssetsRoot()+"/images/contextualmenu_move_off.png",iconNonIdle:j.getAssetsRoot()+"/images/contextualmenu_move_on.png",smallIcon:j.getAssetsRoot()+"/images/contextualmenu_move_on.png"}),h.addContextualMenuButton({key:"se.cms.remove",nameI18nKey:"contextmenu.title.Remove",regexpKeys:["^((?!Slot).)*$"],condition:function(a){return!0},callback:function(a,c){var d=i.getOriginalComponent(a.componentId,a.componentType).get(0),g=i.getSlotOperationRelatedId(d),h=i.getSlotOperationRelatedType(d);f.removeComponent({slotId:a.slotId,componentId:a.componentId,componentType:a.componentType,slotOperationRelatedId:g,slotOperationRelatedType:h}).then(function(){b("alert.component.removed.from.slot",{componentID:g,slotID:a.slotId}).then(function(a){e.pushAlerts([{successful:!0,message:a,closeable:!0}]),c.preventDefault(),c.stopPropagation()})})},displayClass:"removebutton",iconIdle:j.getAssetsRoot()+"/images/contextualmenu_delete_off.png",iconNonIdle:j.getAssetsRoot()+"/images/contextualmenu_delete_on.png",smallIcon:j.getAssetsRoot()+"/images/contextualmenu_delete_on.png"}),h.addContextualMenuButton({key:"se.slotContextualMenuVisibility",nameI18nKey:"slotcontextmenu.title.visibility",regexpKeys:["^.*ContentSlot$"],callback:function(){},templateUrl:"web/features/cmssmartedit/slotVisibility/slotVisibilityWidgetTemplate.html"}),h.addContextualMenuButton({key:"se.slotSharedButton",nameI18nKey:"slotcontextmenu.title.shared.button",regexpKeys:["^.*Slot$"],callback:function(){},templateUrl:"web/features/cmssmartedit/slotShared/slotSharedTemplate.html"})}]),angular.module("editorEnablerServiceModule",["featureServiceModule","editorModalServiceModule","functionsModule"]).factory("editorEnablerService",["featureService","editorModalService","hitch",function(a,b,c){function d(){}return d.prototype._key="se.cms.edit",d.prototype._nameI18nKey="contextmenu.nameI18nKey.edit",d.prototype._descriptionI18nKey="contextmenu.descriptionI18n.edit",d.prototype._editDisplayClass="editbutton",d.prototype._editButtonIconIdle="/cmssmartedit/images/contextualmenu_edit_off.png",d.prototype._editButtonIconNonIdle="/cmssmartedit/images/contextualmenu_edit_on.png",d.prototype._editButtonSmallIcon="/cmssmartedit/images/contextualmenu_edit_on.png",d.prototype._editButtonCallback=function(a){b.open(a.componentType,a.componentId)},d.prototype.enableForComponents=function(b){var c={key:this._key,nameI18nKey:this._nameI18nKey,descriptionI18nKey:this._descriptionI18nKey,regexpKeys:b,displayClass:this._editDisplayClass,i18nKey:this._editI18nKey,iconIdle:this._editButtonIconIdle,iconNonIdle:this._editButtonIconNonIdle,smallIcon:this._editButtonSmallIcon,callback:this._editButtonCallback};a.addContextualMenuButton(c)},new d}]),angular.module("editorModalServiceModule",["gatewayProxyModule"]).factory("editorModalService",["gatewayProxy",function(a){function b(){this.gatewayId="EditorModal",a.initForService(this,["open","openAndRerenderSlot"])}return b.prototype.open=function(a,b){},b.prototype.openAndRerenderSlot=function(a,b){},new b}]),angular.module("removeComponentServiceModule",["restServiceFactoryModule","renderServiceModule","gatewayProxyModule","removeComponentServiceInterfaceModule","experienceInterceptorModule","functionsModule","resourceLocationsModule"]).factory("removeComponentService",["restServiceFactory","renderService","extend","gatewayProxy","$q","$log","RemoveComponentServiceInterface","experienceInterceptor","PAGES_CONTENT_SLOT_COMPONENT_RESOURCE_URI",function(a,b,c,d,e,f,g,h,i){var j="RemoveComponent",k=function(a){this.gatewayId=a,d.initForService(this,["removeComponent"])};k=c(g,k);var l=a.get(i+"?slotId=:slotId&componentId=:componentId","componentId");return k.prototype.removeComponent=function(a){return l.remove({slotId:a.slotId,componentId:a.slotOperationRelatedId}).then(function(){b.renderRemoval(a.componentId,a.componentType,a.slotId)})},new k(j)}]),angular.module("slotSharedButtonModule",["slotSharedServiceModule"]).controller("slotSharedButtonController",["slotSharedService","$scope","$timeout",function(a,b,c){this.sharedOffImageUrl="/cmssmartedit/images/shared_slot_menu_off.png",this.sharedOnImageUrl="/cmssmartedit/images/shared_slot_menu_on.png",this.slotSharedFlag=!1,this.isPopupOpened=!1,this.buttonName="slotSharedButton",a.isSlotShared(this.slotId).then(function(a){this.slotSharedFlag=a}.bind(this)),this.positionHiddenComponentList=function(){c(function(){var a=$("#sharedSlotButton-"+this.slotId),b=$("#shared-slot-list-"+this.slotId),c=b.offset().left+b.width()-$("body").width();c>=0&&b.offset({left:a.offset().left+a.width()-b.width()-45,top:b.offset().top})}.bind(this))},this.openPopup=function(a){a.preventDefault(),a.stopPropagation(),this.positionHiddenComponentList(),this.isPopupOpened=!0,this.setRemainOpen({button:this.buttonName,remainOpen:!0})}}]).directive("slotSharedButton",function(){return{templateUrl:"web/features/cmssmartedit/slotShared/slotSharedButtonTemplate.html",restrict:"E",controller:"slotSharedButtonController",controllerAs:"ctrl",scope:{},bindToController:{setRemainOpen:"&",active:"=",slotId:"@"}}}),angular.module("slotSharedServiceModule",["resourceModule","componentHandlerServiceModule","resourceLocationsModule"]).service("slotSharedService",["restServiceFactory","$q","componentHandlerService","PAGES_CONTENT_SLOT_RESOURCE_URI",function(a,b,c,d){var e,f=a.get(d),g=c.getPageUID(),h=function(a){return f.get({slotId:a}).then(function(b){var c=b.pageContentSlotList.map(function(a){return a.pageId}).filter(i),d={};return d[a]=c.length>1,d})},i=function(a,b,c){return c.indexOf(a)===b},j=function(a){return a.slotId};this.reloadSharedSlotMap=function(){return e=f.get({pageId:g}).then(function(a){var c=(a.pageContentSlotList||[]).map(j).filter(i).map(h);return b.all(c).then(function(a){return a.reduce(function(a,b){return angular.extend({},a,b)},{})})})},this.isSlotShared=function(a){return e.then(function(b){return b[a]})}}]).run(["slotSharedService",function(a){a.reloadSharedSlotMap()}]),angular.module("slotVisibilityButtonModule",["slotVisibilityServiceModule","slotVisibilityComponentModule"]).controller("slotVisibilityButtonController",["slotVisibilityService","$scope","$timeout",function(a,b,c){this.buttonName="slotVisibilityButton",this.eyeOnImageUrl="/cmssmartedit/images/visibility_slot_menu_on.png",this.eyeOffImageUrl="/cmssmartedit/images/visibility_slot_menu_off.png",this.eyeImageUrl=this.eyeOffImageUrl,this.closeImageUrl="/cmssmartedit/images/close_button.png",this.buttonVisible=!1,this.hiddenComponents=[],this.isComponentListOpened=!1,b.$watch("ctrl.isComponentListOpened",function(a,b){this.eyeImageUrl=a?this.eyeOnImageUrl:this.eyeOffImageUrl,a!==b&&this.setRemainOpen({button:this.buttonName,remainOpen:this.isComponentListOpened})}.bind(this)),this.onInit=function(){a.getHiddenComponents(this.slotId).then(function(a){this.hiddenComponents=a,this.hiddenComponentCount=a.length,this.hiddenComponentCount>0&&(this.buttonVisible=!0)}.bind(this))},this.positionHiddenComponentList=function(){c(function(){var a=$("#slot-visibility-button-"+this.slotId),b=$("#slot-visibility-list-"+this.slotId),c=b.offset().left+b.width()-$("body").width();c>=0&&b.offset({left:a.offset().left+a.width()-b.width(),top:b.offset().top})}.bind(this))},this.openHiddenComponentList=function(a){a.preventDefault(),a.stopPropagation(),this.positionHiddenComponentList(),this.isComponentListOpened=!0,this.setRemainOpen({button:this.buttonName,remainOpen:!0})},this.closeHiddenComponentList=function(a){a.preventDefault(),a.stopPropagation(),this.isComponentListOpened=!1,this.setRemainOpen({button:this.buttonName,remainOpen:!1})},this.onInit()}]).directive("slotVisibilityButton",function(){return{templateUrl:"web/features/cmssmartedit/slotVisibility/slotVisibilityButtonTemplate.html",restrict:"E",transclude:!0,replace:!1,controller:"slotVisibilityButtonController",controllerAs:"ctrl",scope:{},bindToController:{setRemainOpen:"&",slotId:"@",initButton:"@"}}}),angular.module("slotVisibilityComponentModule",["editorModalServiceModule"]).controller("slotVisibilityComponentController",["editorModalService",function(a){this.imageRoot="/cmssmartedit/images",this.openEditorModal=function(){a.openAndRerenderSlot(this.component.typeCode,this.component.uid,this.slotId)}}]).directive("slotVisibilityComponent",function(){return{templateUrl:"web/features/cmssmartedit/slotVisibility/slotVisibilityComponentTemplate.html",restrict:"E",transclude:!1,replace:!0,controller:"slotVisibilityComponentController",controllerAs:"ctrl",scope:{},bindToController:{component:"=",slotId:"@"}}}),angular.module("slotVisibilityServiceModule",["resourceModule","componentHandlerServiceModule","functionsModule","renderServiceModule"]).service("SlotVisibilityService",["itemsResource","pagesContentSlotsComponentsResource","componentHandlerService","renderService",function(a,b,c,d){function e(){var e,f=c.getPageUID(),g=function(a,b){var c=(b.componentItems||[]).filter(function(a){return!a.visible}).reduce(function(a,b){return a[b.uid]=b,a},{}),d=(a.pageContentSlotComponentList||[]).reduce(function(a,b){return a[b.slotId]=a[b.slotId]||[],c[b.componentId]&&a[b.slotId].push(c[b.componentId]),a},{});return d},h=function(b){var c=(b.pageContentSlotComponentList||[]).map(function(a){return a.componentId});return a.get({uids:c.join(",")}).then(function(a){return g(b,a)})},i=function(){return e=b.get({pageId:f}).then(h)},j=function(a,b){var c=[];Object.keys(a).forEach(function(d){a[d]&&b[d]&&a[d].length!==b[d].length&&c.push(d)}),c.length>0&&d.renderSlots(c)};this.loadHiddenComponents=function(){return e?this.reLoadHiddenComponents():e=i()},this.reLoadHiddenComponents=function(){return e.then(function(a){var b=angular.copy(a);e=i(),e.then(function(a){j(b,a)})}),e},this.getHiddenComponentCount=function(a){return this.getHiddenComponents(a).then(function(a){return a.length})},this.getHiddenComponents=function(a){return(e||this.loadHiddenComponents()).then(function(b){return b[a]||[]},function(a){return[]})}}return e}]).service("slotVisibilityService",["SlotVisibilityService","systemEventService","throttle","$q",function(a,b,c,d){var e=new a;e.loadHiddenComponents();var f=c(function(){e.loadHiddenComponents()},2e3);return b.registerEventHandler("SLOT_CONTEXTUAL_MENU_ACTIVE",function(){return f(),d.when()}),e}]),angular.module("synchronizeDecorator",["restServiceFactoryModule","translationServiceModule","functionsModule"]).factory("SynchronizeService",["restServiceFactory","hitch","$q",function(a,b,c){var d=function(b,c){this.smarteditComponentType=b,this.smarteditComponentId=c,this.restService=a.get("/cmswebservices/:smarteditComponentType/:smarteditComponentId/synchronize"),this.synced=!0};return d.prototype.load=function(){var a=c.defer();return this.restService.get({smarteditComponentType:this.smarteditComponentType,smarteditComponentId:this.smarteditComponentId}).then(b(this,function(b){this.synced=b.status,a.resolve(this.synced)})),a.promise},d.prototype.synchronize=function(){var a=c.defer();return this.restService.save({smarteditComponentType:this.smarteditComponentType,smarteditComponentId:this.smarteditComponentId},{}).then(b(this,function(b){this.synced=b.status,a.resolve(this.synced)})),a.promise},d}]).directive("synchronize",["$timeout","SynchronizeService",function(a,b){return{templateUrl:"web/features/cmssmartedit/synchronize/synchronizeDecoratorTemplate.html",restrict:"C",transclude:!0,replace:!1,scope:{smarteditComponentId:"@",smarteditComponentType:"@",active:"="},link:function(c,d,e){c.service=new b(c.smarteditComponentType,c.smarteditComponentId),c.service.load(),c.isContainer="ContentSlotModel"==c.smarteditComponentType,c.visible=!1,c.mouseleave=function(){a(function(){c.visible=!1},1e3)},c.mouseenter=function(){c.visible=!0}}}}]),angular.module("cmssmarteditTemplates",[]).run(["$templateCache",function(a){"use strict";a.put("web/features/cmssmartedit/slotShared/slotSharedButtonTemplate.html",'<div class="shared-slot-button-template">\n	<div class="btn-group shared-slot-button-template__btn-group" dropdown dropdown-append-to-body is-open="ctrl.isPopupOpened">\n		<button type="button"  id="sharedSlotButton-{{::ctrl.slotId}}" class="btn btn-primary dropdown-toggle shared-slot-button-template__btn" \n				data-ng-if="ctrl.slotSharedFlag" data-ng-click="ctrl.openPopup($event)">\n			<img class="shared-slot-button-template__btn__img" data-ng-src="{{ ctrl.isPopupOpened && ctrl.sharedOnImageUrl || ctrl.sharedOffImageUrl }}"/>\n		</button>\n		<ul class="dropdown-menu dropdown-menu-right shared-slot-button-template__menu" role="menu" id="shared-slot-list-{{::ctrl.slotId}}">\n			<lh class="shared-slot-button-template__menu__title">\n				<p class="shared-slot-button-template__menu__title__text">{{::\'slot.shared.popover.message\'| translate}}</p>\n			</lh>\n		</ul>\n	</div>\n</div>\n'),a.put("web/features/cmssmartedit/slotShared/slotSharedTemplate.html",'<slot-shared-button data-slot-id="{{::ctrl.smarteditComponentId}}"></slot-shared-button>\n'),a.put("web/features/cmssmartedit/slotVisibility/slotVisibilityButtonTemplate.html",'<div class="slot-visibility-button-template">\n	<div class="btn-group slot-visibility-button-template__btn-group" dropdown dropdown-append-to-body is-open="ctrl.isComponentListOpened">\n		<button type="button" class="btn btn-primary dropdown-toggle slot-visibility-button-template__btn" \n				data-ng-click="ctrl.openHiddenComponentList($event)"\n				data-ng-if="ctrl.buttonVisible" id="slot-visibility-button-{{::ctrl.slotId}}">\n			<img class="slot-visibility-button-template__btn__img " data-ng-src="{{ ctrl.eyeImageUrl }}"/>{{ ::ctrl.hiddenComponentCount }}\n		</button>\n		<ul class="dropdown-menu dropdown-menu-right slot-visibility-button-template__menu" role="menu" id="slot-visibility-list-{{::ctrl.slotId}}">\n			<lh class="slot-visibility-button-template__menu__title">\n				<p class="slot-visibility-button-template__menu__title__text">{{\'slotvisibility.list.title\' | translate}}</p>\n				<img class="slot-visibility-button-template__menu__title__close-btn" data-ng-src="{{ ::ctrl.closeImageUrl }}" data-ng-click="ctrl.closeHiddenComponentList($event)"/>\n			</lh>\n			<li class="slot-visibility-component slot-visibility-button-template__menu__component" data-ng-repeat="component in ctrl.hiddenComponents">\n				<slot-visibility-component data-component="component" data-slot-id="{{::ctrl.slotId}}"></slot-visibility-component>\n			</li>\n		</ul>\n	</div>\n</div>\n'),a.put("web/features/cmssmartedit/slotVisibility/slotVisibilityComponentTemplate.html",'<div class="slot-visiblity-component-template">\n	<div class="slot-visiblity-component-template__icon">\n		<img data-ng-src="{{::ctrl.imageRoot}}/component_default.png" class="slot-visiblity-component-template__icon__image" alt="{{::ctrl.component.typeCode}}"/>\n	</div>\n	<div class="slot-visiblity-component-template__text">\n		<a class="slot-visiblity-component-template__text__name" href="#" data-ng-click="ctrl.openEditorModal()">{{ ::ctrl.component.name }}</a>\n		<p class="slot-visiblity-component-template__text__type">{{ ::ctrl.component.typeCode }}</p>\n	</div>\n</div>\n'),a.put("web/features/cmssmartedit/slotVisibility/slotVisibilityWidgetTemplate.html",'<slot-visibility-button data-slot-id="{{::ctrl.smarteditComponentId}}" \n						data-set-remain-open="ctrl.setRemainOpen(button, remainOpen)"/>\n'),a.put("web/features/cmssmartedit/synchronize/synchronizeDecoratorTemplate.html",'<div>\n    <div data-ng-mouseleave="mouseleave()">\n        <img title="{{\'synchronize.notok.tooltip\' | translate}}" data-ng-if="!service.synced && visible" class="ng-class:{synchronize:true, clickable:true, \'pull-right\':!isContainer}" data-ng-click="service.synchronize()" data-ng-src=/cmssmartedit/images/synchronization_notok.gif />\n        <img title="{{\'synchronize.ok.tooltip\' | translate}}" data-ng-if="service.synced && visible" class="ng-class:{synchronize:true, clickable:true, \'pull-right\':!isContainer}" data-ng-src=/cmssmartedit/images/synchronization_ok.gif />\n        <div data-ng-mouseenter="mouseenter()" class="ng-class:{minDivHeight:true, contentSlot:isContainer && visible}">\n            <div data-ng-transclude></div>\n        </div>\n    </div>\n</div>\n')}]),angular.module("assetsServiceModule",[]).constant("testAssets",!1).factory("assetsService",["testAssets",function(a){return{getAssetsRoot:function(){return a?"/web/webroot":"/cmssmartedit"}}}]),angular.module("removeComponentServiceInterfaceModule",[]).factory("RemoveComponentServiceInterface",function(){function a(){}return a.prototype.removeComponent=function(a,b){},a}),function(){angular.module("resourceModule",["restServiceFactoryModule","resourceLocationsModule"]).factory("itemsResource",["restServiceFactory","ITEMS_RESOURCE_URI",function(a,b){return a.get(b)}]).factory("pagesContentSlotsComponentsResource",["restServiceFactory","PAGES_CONTENT_SLOT_COMPONENT_RESOURCE_URI",function(a,b){return a.get(b)}])}(),function(){var a="CURRENT_CONTEXT_CATALOG",b="CURRENT_CONTEXT_CATALOG_VERSION",c="CURRENT_CONTEXT_SITE_ID";angular.module("resourceLocationsModule").constant("TYPES_RESOURCE_URI","/cmswebservices/v1/types").constant("ITEMS_RESOURCE_URI","/cmswebservices/v1/sites/"+c+"/catalogs/"+a+"/versions/"+b+"/items").constant("PAGES_CONTENT_SLOT_COMPONENT_RESOURCE_URI","/cmswebservices/v1/sites/"+c+"/catalogs/"+a+"/versions/"+b+"/pagescontentslotscomponents").constant("CONTENT_SLOT_TYPE_RESTRICTION_RESOURCE_URI","/cmswebservices/v1/catalogs/"+a+"/versions/"+b+"/pages/:pageUid/contentslots/:slotUid/typerestrictions").constant("PAGES_LIST_RESOURCE_URI","/cmswebservices/v1/sites/:siteUID/catalogs/:catalogId/versions/:catalogVersion/pages").constant("PAGE_LIST_PATH","/pages/:siteId/:catalogId/:catalogVersion").constant("PAGES_CONTENT_SLOT_RESOURCE_URI","/cmswebservices/v1/sites/"+c+"/catalogs/"+a+"/versions/"+b+"/pagescontentslots").constant("PAGE_TEMPLATES_URI","/cmswebservices/v1/sites/:siteUID/catalogs/:catalogId/versions/:catalogVersion/pagetemplates")}(),angular.module("componentServiceModule",["restServiceFactoryModule","functionsModule","resourceLocationsModule"]).factory("ComponentService",["restServiceFactory","hitch","$q","$log","parseQuery","TYPES_RESOURCE_URI","ITEMS_RESOURCE_URI","PAGES_CONTENT_SLOT_COMPONENT_RESOURCE_URI",function(a,b,c,d,e,f,g,h){var i=a.get(f),j=a.get(g),k=a.get(g),l=a.get(h),m=!1,n=!1,o={},p={},q={},r=function(a,b,d,e,f){var g=c.defer();return q.name=a,q.slotId=e,q.pageId=d,q.position=f,q.typeCode=b,k.save(q).then(function(a){g.resolve(a)},function(a){g.reject(a)}),g.promise},s=function(a,b,d,e){var f=c.defer();return q.pageId=a,q.slotId=d,q.componentId=b,q.position=e,l.save(q).then(function(a){f.resolve()},function(a){f.reject(a)}),f.promise},t=function(){var a=c.defer();return i.get().then(function(b){return angular.copy(b,o),a.resolve(o),m=!0,a.promise},function(){return m=!1,a.reject(),a.promise}),a.promise},u=function(a){return j.getById(a)},v=function(){var a=c.defer();return j.get().then(function(b){angular.copy(b,p),a.resolve(p),n=!0},function(){n=!1,a.reject()}),a.promise},w=function(a,b,c){return j.get({pageSize:b,currentPage:c,mask:a,sort:"name"})};return{loadComponentTypes:t,listOfComponentTypes:o,loadComponentItem:u,loadComponentItems:v,loadPagedComponentItems:w,listOfComponentItems:p,addNewComponent:r,addExistingComponent:s}}]);